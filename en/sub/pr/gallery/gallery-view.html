<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gallery Details | Fine Defense</title>

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <style>
    .gallery-view-wrap {
      max-width: 1000px;
      margin: 50px auto 80px;
      padding: 0 20px;
    }

    .gallery-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #111;
    }

    .gallery-meta {
      font-size: 0.9rem;
      color: #777;
      margin-bottom: 25px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 12px;
    }

    .gallery-main-image {
      width: 100%;
      max-height: 520px;
      object-fit: contain;
      background: #000;
      border-radius: 12px;
    }

    .gallery-thumb-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .gallery-thumb {
      width: 90px;
      height: 60px;
      border-radius: 6px;
      object-fit: cover;
      cursor: pointer;
      opacity: 0.7;
      border: 2px solid transparent;
    }

    .gallery-thumb.active {
      opacity: 1;
      border-color: #0f2679;
    }

    .gallery-desc {
      margin-top: 30px;
      line-height: 1.7;
      font-size: 0.98rem;
    }

    .back-btn {
      margin-top: 35px;
      padding: 9px 18px;
      border-radius: 6px;
      border:1px solid #0f2679;
      background:#fff;
      color:#0f2679;
      cursor:pointer;
      font-size:0.9rem;
    }
    .back-btn:hover {
      background:#0f2679;
      color:#fff;
    }
  </style>
</head>

<body>

  <!-- Admin Session Bar -->
  <div id="adminBarContainer" data-include="/en/components/admin-session-bar.html"></div>

  <!-- Common Header -->
  <div id="headerContainer" data-include="/en/components/header.html"></div>

  <!-- Sub Banner -->
  <section class="sub-banner">
    <img src="/img/sub-banners/subbanner_pr.png" alt="Media Center Banner" />
    <div class="banner-text">
      <h1>Media Center</h1>
      <p>Explore the latest updates and promotional materials from Fine Defense.</p>
    </div>
  </section>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="/en/index.html">Home</a> &gt;
    <span class="crumb crumb-level1">Media Center</span> &gt;
    <span class="crumb crumb-level2">Gallery</span>
    <div id="side-tabs" class="side-tabs"></div>
  </div>

  <!-- Detail Page -->
  <div class="gallery-view-wrap">
    <div class="gallery-title" id="title">Loading...</div>
    <div class="gallery-meta" id="meta"></div>

    <img id="mainImage" class="gallery-main-image" src="/img/no-image.jpg">
    <div id="thumbRow" class="gallery-thumb-row"></div>

    <div class="gallery-desc" id="description"></div>

    <button class="back-btn" onclick="location.href='/en/sub/pr/gallery/index.html'">
      Return to List
    </button>
  </div>


    <!-- 공통 푸터 -->
    <div data-include="/en/components/footer.html"></div>


  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get("id");

    if (!id) {
      location.href = "/en/sub/pr/gallery/index.html";
    }

    async function loadGalleryDetail() {
      try {
        // 조회수 증가
        fetch(`/api/posts/view/${id}`, { method: "POST" }).catch(() => {});

        // 상세 데이터
        const res = await fetch(`/api/posts/detail/${id}`);
        const data = await res.json();

        document.getElementById("title").textContent = data.title ?? "제목 없음";

        const dateText = data.created_at
          ? new Date(data.created_at).toLocaleDateString()
          : "";
        const views = data.views ?? 0;

        document.getElementById("meta").textContent =
          `${dateText}${dateText ? " | " : ""}조회수 ${views}`;

        document.getElementById("description").innerHTML = data.content || "";

        const images = data.images || [];

        const mainImgEl = document.getElementById("mainImage");
        const thumbRow = document.getElementById("thumbRow");

        if (!images.length) {
          mainImgEl.src = "/img/no-image.jpg";
          thumbRow.innerHTML = "";
          return;
        }

        mainImgEl.src = images[0];

        thumbRow.innerHTML = images
          .map(
            (src, idx) => `
          <img src="${src}" 
               class="gallery-thumb ${idx === 0 ? "active" : ""}" 
               data-idx="${idx}">
        `
          )
          .join("");

        thumbRow.addEventListener("click", (e) => {
          const img = e.target;
          if (!img.classList.contains("gallery-thumb")) return;

          const idx = Number(img.dataset.idx);
          mainImgEl.src = images[idx];

          document
            .querySelectorAll(".gallery-thumb")
            .forEach(t => t.classList.remove("active"));

          img.classList.add("active");
        });

      } catch (err) {
        console.error(err);
        document.getElementById("title").textContent =
          "데이터를 불러오는 중 오류가 발생했습니다.";
      }
    }

    loadGalleryDetail();
  </script>

    <!-- 공통 스크립트 -->
    <script src="/js/include.js"></script>
    <script src="/js/session_timer.js"></script>
    <script src="/js/language.js"></script>
    <script src="/js/nav.js"></script>


</body>
</html>
