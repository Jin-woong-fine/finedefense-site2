<!-- /kr/admin/recruit-manage.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>채용공고 · 인재 DB 관리 | Fine Defense Admin</title>

  <!-- 공통 관리자 CSS -->
  <link rel="stylesheet" href="/kr/admin/css/admin.css">

  <!-- 세션 매니저 -->
  <script type="module" src="/js/session_manager.js"></script>
  <script type="module" src="/kr/admin/js/dashboard_session_timer.js"></script>

  <style>
  .panel {
    background: #fff;
    padding: 26px 28px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(15,38,121,0.08);
  }

  /* ===============================
     ADMIN TABS
  =============================== */
  .admin-tabs {
    display: flex;
    gap: 6px;
    margin-bottom: 20px;
    border-bottom: 1px solid #dbe1ff;
  }

  .tab-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 8px 8px 0 0;
    background: #f3f6ff;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
  }

  .tab-btn.active {
    background: #0f2679;
    color: #fff;
  }

  .tab-panel {
    display: none;
  }

  .tab-panel.active {
    display: block;
  }

  /* ===============================
     TABLE
  =============================== */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 12px;
    border-radius: 12px;
    overflow: hidden;
    font-size: 0.95rem;
  }

  th, td {
    padding: 11px 14px;
    border-bottom: 1px solid #e1e6f5;
  }

  th {
    background: #0f2679;
    color: #fff;
    font-weight: 600;
    font-size: 0.9rem;
  }

  tbody tr:hover td {
    background: #f0f4ff;
  }

  .actions {
    display: flex;
    gap: 6px;
  }


  .recruit-title {
    color: #0f2679;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
  }

  .recruit-title:hover {
    text-decoration: underline;
  }

  </style>
</head>

<body>

<!-- SIDEBAR -->
<div id="sidebar" data-active="recruit"></div>

<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="title">채용공고 · 인재 DB 관리</div>

    <div style="display:flex; align-items:center; gap:12px;">
      <span id="session-timer" class="session-timer">세션 계산중...</span>

      <div class="topbar-user" id="topbarUser">
        <span id="topbarUserName">관리자</span> ▾
        <div class="user-dropdown" id="userDropdown"></div>
      </div>

      <button onclick="location.href='../index.html'">홈으로</button>
    </div>
  </div>

  <section class="panel">

    <!-- TABS -->
    <div class="admin-tabs">
      <button class="tab-btn active" data-tab="recruit">채용공고 관리</button>
      <button class="tab-btn" data-tab="talent">인재 DB 관리</button>
    </div>

    <!-- ===============================
         채용공고 관리
    =============================== -->
    <div class="tab-panel active" id="tab-recruit">

      <div style="display:flex;justify-content:space-between;margin-bottom:14px;">
        <input type="text" placeholder="공고 제목 검색" class="search-input">
        <button class="btn btn-primary"
                onclick="goRecruitWrite()">채용공고 작성</button>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:70px;">번호</th>
            <th>제목</th>
            <th style="width:120px;">고용형태</th>
            <th style="width:100px;">경력</th>
            <th style="width:120px;">근무지</th>
            <th style="width:100px;">상태</th>
            <th style="width:140px;">관리</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>연구개발 엔지니어 채용</td>
            <td>정규직</td>
            <td>경력</td>
            <td>서울</td>
            <td>공개</td>
            <td>
              <div class="actions">
                <button class="btn btn-small btn-gray">수정</button>
                <button class="btn btn-small btn-danger">비공개</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </div>

    <!-- ===============================
         인재 DB 관리
    =============================== -->
    <div class="tab-panel" id="tab-talent">

      <div style="display:flex;justify-content:space-between;margin-bottom:14px;">
        <input type="text" placeholder="이름 / 이메일 검색" class="search-input">
      </div>

      <table>
        <thead>
          <tr>
            <th style="width:70px;">번호</th>
            <th>이름</th>
            <th>이메일</th>
            <th style="width:120px;">등록일</th>
            <th style="width:80px;">첨부</th>
            <th style="width:120px;">관리</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>홍길동</td>
            <td>hong@test.com</td>
            <td>2026-01-13</td>
            <td>O</td>
            <td>
              <div class="actions">
                <button class="btn btn-small btn-gray">상세</button>
                <button class="btn btn-small btn-danger">삭제</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </div>

  </section>
</div>

<script src="/kr/admin/js/common_auth.js"></script>
<script src="/kr/admin/js/sidebar.js"></script>
<script src="/kr/admin/js/topbar_user_menu.js"></script>


<script>
requireEditPermission();
loadSidebar("recruit");


function viewRecruit(id) {
  location.href = `/kr/sub/support/recruit/recruit-view.html?id=${id}`;
}


/* ===============================
   TAB SWITCH
=============================== */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const tab = btn.dataset.tab;

    document.querySelectorAll(".tab-btn")
      .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    document.querySelectorAll(".tab-panel")
      .forEach(p => p.classList.remove("active"));
    document.getElementById("tab-" + tab)
      .classList.add("active");
  });
});

/* ===============================
   채용공고 로드
=============================== */
async function loadRecruitPosts() {
  const res = await fetch("/api/recruit/list", {
    headers: {
      Authorization: "Bearer " + localStorage.getItem("token")
    }
  });

  if (!res.ok) {
    console.error("❌ 채용공고 목록 로드 실패");
    return;
  }

  const list = await res.json();
  const tbody = document.querySelector("#tab-recruit tbody");
  tbody.innerHTML = "";

  list.forEach((r, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>
          <a href="javascript:void(0)"
            class="recruit-title"
            onclick="viewRecruit(${r.id})">
            ${r.title}
          </a>
        </td>
        <td>${r.employment_type || "-"}</td>
        <td>${r.career_level || "-"}</td>
        <td>${r.location || "-"}</td>
        <td>${r.is_active ? "공개" : "비공개"}</td>
        <td>
          <div class="actions">
            <button class="btn btn-small btn-gray"
              onclick="editRecruit(${r.id})">수정</button>
            <button class="btn btn-small btn-danger"
              onclick="toggleRecruit(${r.id}, ${r.is_active})">
              ${r.is_active ? "비공개" : "공개"}
            </button>
          </div>
        </td>
      </tr>
    `;
  });

}




/* ===============================
   인재 DB 로드
=============================== */
async function loadTalentDB() {
  const res = await fetch("/api/recruit/talents", {
    headers: {
      Authorization: "Bearer " + localStorage.getItem("token")
    }
  });

  if (!res.ok) {
    console.error("❌ 인재 DB 로드 실패");
    return;
  }

  const list = await res.json();
  const tbody = document.querySelector("#tab-talent tbody");
  tbody.innerHTML = "";

  list.forEach((t, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${t.name}</td>
        <td>${t.email}</td>
        <td>${t.created_at.slice(0, 10)}</td>
        <td>${t.resume_path ? "O" : "-"}</td>
        <td>
          <div class="actions">
            <button class="btn btn-small btn-gray"
              onclick="viewTalent(${t.id})">상세</button>
            <button class="btn btn-small btn-danger"
              onclick="deleteTalent(${t.id})">삭제</button>
          </div>
        </td>
      </tr>
    `;
  });
}


/* ===============================
   액션
=============================== */

function goRecruitWrite() {
  location.href = "/kr/admin/recruit-write.html";
}

function editRecruit(id) {
  location.href = `/kr/admin/recruit-edit.html?id=${id}`;
}

async function toggleRecruit(id, active) {
  if (!confirm("상태를 변경하시겠습니까?")) return;

  const res = await fetch(`/api/recruit/toggle/${id}`, {
    method: "PUT",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("token")
    },
    body: JSON.stringify({ is_active: active ? 0 : 1 })
  });

  if (!res.ok) {
    alert("상태 변경 실패");
    return;
  }

  loadRecruitPosts();
}



/* ===============================
   인재 삭제
=============================== */
async function deleteTalent(id) {
  if (!confirm("인재 정보를 삭제하시겠습니까?")) return;

  const res = await fetch(`/api/recruit/talent/${id}`, {
    method: "DELETE",
    headers: {
      Authorization: "Bearer " + localStorage.getItem("token")
    }
  });

  if (!res.ok) {
    alert("삭제 실패");
    return;
  }

  loadTalentDB();
}

function viewTalent(id) {
  window.open(`/kr/admin/recruit_talent_view.html?id=${id}`, "_blank");
}

/* ===============================
   INIT
=============================== */
loadRecruitPosts();
loadTalentDB();
</script>




</body>
</html>
