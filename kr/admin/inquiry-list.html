<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬¸ì˜ ê´€ë¦¬ | Fine Defense Admin</title>

  <!-- ê³µí†µ ê´€ë¦¬ì CSS -->
  <link rel="stylesheet" href="/kr/admin/css/admin.css" />

  <style>
    .panel {
      background:#fff;
      padding:25px;
      border-radius:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.06);
      margin-bottom:35px;
    }

    .status-chip {
      display:inline-block;
      padding:4px 10px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
    }
    .status-0 { background:#ffe8e8; color:#d10000; }
    .status-1 { background:#e8f5ff; color:#0058c6; }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
    }

    th, td {
      padding:12px 14px;
      border-bottom:1px solid #ddd;
      text-align:left;
      font-size:14px;
    }

    th {
      background:#0f2679;
      color:white;
      font-weight:600;
    }

    tr:hover td {
      background:#f3f6ff;
      cursor:pointer;
    }

    .filter-box {
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:15px;
    }

    .filter-btn {
      padding:7px 16px;
      border:1px solid #ccc;
      background:white;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
    }
    .filter-btn.active {
      background:#0f2679;
      color:white;
      border-color:#0f2679;
    }
  </style>
</head>

<body>

<!-- â­ ì‚¬ì´ë“œë°” -->
<div id="sidebar" data-active="inquiry"></div>

<!-- â­ ë©”ì¸ -->
<div class="main">

  <!-- ğŸ”µ TOPBAR -->
  <div class="topbar">
    <div class="title">ë¬¸ì˜ ê´€ë¦¬</div>

    <div style="display:flex; align-items:center; gap:12px;">

      <!-- â­ ì„¸ì…˜ íƒ€ì´ë¨¸ -->
      <span id="session-timer" class="session-timer">ì„¸ì…˜ ê³„ì‚°ì¤‘...</span>

      <div class="topbar-user" id="topbarUser">
        <span id="topbarUserName">ê´€ë¦¬ì</span> â–¾
        <div class="user-dropdown" id="userDropdown"></div>
      </div>

      <button onclick="location.href='../index.html'">í™ˆìœ¼ë¡œ</button>
    </div>
  </div>

  <section class="panel">

    <!-- í•„í„° ì˜ì—­ -->
    <div class="filter-box">
      <button class="filter-btn active" data-filter="all">ì „ì²´</button>
      <button class="filter-btn" data-filter="unread">ë¯¸í™•ì¸</button>
      <button class="filter-btn" data-filter="kr">KR</button>
      <button class="filter-btn" data-filter="en">EN</button>
    </div>

    <!-- í…Œì´ë¸” -->
    <table>
      <thead>
        <tr>
          <th style="width:70px;">ID</th>
          <th style="width:90px;">ì–¸ì–´</th>
          <th style="width:150px;">ì´ë¦„</th>
          <th>ì œëª©</th>
          <th style="width:180px;">ì´ë©”ì¼</th>
          <th style="width:150px;">ë‚ ì§œ</th>
          <th style="width:100px;">ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="inquiryTable">
        <tr><td colspan="7" style="text-align:center;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
      </tbody>
    </table>

  </section>

</div>

<!-- ê³µí†µ JS -->
<script src="/kr/admin/js/sidebar.js"></script>
<script src="/kr/admin/js/common_auth.js"></script>

<script>
  requireEditPermission()

  let allData = [];
  let currentFilter = "all";

  document.addEventListener("DOMContentLoaded", () => {
    loadInquiryList();

    document.querySelectorAll(".filter-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentFilter = btn.dataset.filter;
        renderTable();
      });
    });
  });

  async function loadInquiryList() {
    const res = await fetch("/api/inquiry/list", {
      headers: { Authorization: "Bearer " + localStorage.getItem("token") }
    });

    const data = await res.json();
    allData = data;
    renderTable();
  }

  function renderTable() {
    const tbody = document.getElementById("inquiryTable");
    tbody.innerHTML = "";

    let filtered = allData;

    if (currentFilter === "unread") {
      filtered = filtered.filter(item => item.status === 0);
    } else if (currentFilter === "kr") {
      filtered = filtered.filter(item => item.lang === "kr");
    } else if (currentFilter === "en") {
      filtered = filtered.filter(item => item.lang === "en");
    }

    if (!filtered.length) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center;color:#777;">ë¬¸ì˜ ì—†ìŒ</td></tr>`;
      return;
    }

    filtered.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.id}</td>
        <td>${(row.lang || "kr").toUpperCase()}</td>
        <td>${row.name}</td>
        <td>${row.subject || "-"}</td>
        <td>${row.email}</td>
        <td>${formatDate(row.created_at)}</td>
        <td><span class="status-chip status-${row.status}">${row.status === 0 ? "ë¯¸í™•ì¸" : "í™•ì¸"}</span></td>
      `;
      tr.onclick = () => location.href = `/kr/admin/inquiry-view.html?id=${row.id}`;
      tbody.appendChild(tr);
    });
  }

  function formatDate(dt) {
    const d = new Date(dt);
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  }

  // ì‚¬ì´ë“œë°” í™œì„±í™”
  loadSidebar("inquiry");
</script>

</body>
</html>
