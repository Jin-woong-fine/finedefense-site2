<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬¸ì˜ ëª©ë¡ | Fine Defense ê´€ë¦¬ì</title>

  <link rel="stylesheet" href="./css/admin.css" />

  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      background: #f5f7fb;
    }

    .container {
      margin-left: 240px;
      padding: 40px 50px;
    }

    h2 {
      margin-bottom: 25px;
      font-size: 22px;
      font-weight: 700;
      color: #0f2679;
    }

    .status-chip {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-0 {
      background: #ffe8e8;
      color: #d10000;
    }
    .status-1 {
      background: #e8f5ff;
      color: #0058c6;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    th {
      background: #eef1f7;
      padding: 14px 12px;
      text-align: left;
      font-size: 14px;
      font-weight: 600;
      color: #333;
      border-bottom: 1px solid #ddd;
    }

    td {
      padding: 14px 12px;
      font-size: 14px;
      border-bottom: 1px solid #eee;
    }

    tr:hover {
      background: #f9fbff;
      cursor: pointer;
    }

    .filter-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .filter-btn {
      background: #fff;
      border: 1px solid #ccc;
      padding: 7px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }

    .filter-btn.active {
      border-color: #0f2679;
      background: #0f2679;
      color: white;
    }
  </style>
</head>

<body>
  <div id="sidebar"></div>

  <div class="container">
    <h2>ë¬¸ì˜ ëª©ë¡</h2>

    <!-- í•„í„° -->
    <div class="filter-box">
      <button class="filter-btn active" data-filter="all">ì „ì²´</button>
      <button class="filter-btn" data-filter="unread">ë¯¸í™•ì¸</button>
    </div>

    <!-- í…Œì´ë¸” -->
    <table>
      <thead>
        <tr>
          <th style="width: 80px;">ë²ˆí˜¸</th>
          <th style="width: 150px;">ì´ë¦„</th>
          <th>ì œëª©</th>
          <th style="width: 180px;">ì´ë©”ì¼</th>
          <th style="width: 140px;">ë‚ ì§œ</th>
          <th style="width: 110px;">ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="inquiryTable"></tbody>
    </table>
  </div>

  <script src="./js/sidebar.js"></script>

  <script>
    let allData = [];
    let currentFilter = "all";

    document.addEventListener("DOMContentLoaded", () => {
      loadInquiryList();

      document.querySelectorAll(".filter-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          currentFilter = btn.dataset.filter;
          renderTable();
        });
      });
    });

    // ============================
    // ğŸ“Œ ì „ì²´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    // ============================
    async function loadInquiryList() {
      const res = await fetch("/api/inquiry/list", {
        headers: { Authorization: "Bearer " + localStorage.getItem("token") }
      });

      const data = await res.json();
      allData = data;
      renderTable();
    }

    // ============================
    // ğŸ“Œ í…Œì´ë¸” ë Œë”ë§
    // ============================
    function renderTable() {
      const tbody = document.getElementById("inquiryTable");
      tbody.innerHTML = "";

      let filtered = allData;

      if (currentFilter === "unread") {
        filtered = allData.filter(item => item.status === 0);
      }

      filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.id}</td>
          <td>${row.name}</td>
          <td>${row.subject || "-"}</td>
          <td>${row.email}</td>
          <td>${formatDate(row.created_at)}</td>
          <td>
            <span class="status-chip status-${row.status}">
              ${row.status === 0 ? "ë¯¸í™•ì¸" : "í™•ì¸"}
            </span>
          </td>
        `;

        tr.onclick = () => {
          location.href = `/kr/admin/inquiry-view.html?id=${row.id}`;
        };

        tbody.appendChild(tr);
      });
    }

    function formatDate(dt) {
      const d = new Date(dt);
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    }
  </script>
</body>
</html>
