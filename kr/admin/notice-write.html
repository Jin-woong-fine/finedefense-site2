<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê³µì§€ì‚¬í•­ ì‘ì„± | ê´€ë¦¬ì</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Toast UI Editor -->
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">

  <!-- ê³µí†µ ê´€ë¦¬ì CSS -->
  <link rel="stylesheet" href="/kr/admin/css/admin.css">

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f4f6f9;
      font-family: 'Noto Sans KR', sans-serif;
      display: flex;
    }

    .main {
      flex: 1;
      padding: 25px;
    }

    .panel {
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }

    .input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 1rem;
      box-sizing: border-box;
    }

    #preview img {
      width: 200px;
      border-radius: 8px;
      margin-top: 10px;
      border: 1px solid #ddd;
    }

    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }

    .btn-primary {
      background: #0f2679;
      color: white;
    }

    .topbar {
      background: #fff;
      padding: 16px 24px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>

<body>

<!-- â­ ê´€ë¦¬ì ì‚¬ì´ë“œë°” (ìë™ Active) -->
<div id="sidebar" data-active="notice"></div>

<div class="main">

  <div class="topbar">
    <h2>ê³µì§€ì‚¬í•­ ì‘ì„±</h2>
    <button id="logoutBtn" class="btn btn-primary">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <form id="noticeForm" enctype="multipart/form-data">
    <div class="panel">

      <input id="title" class="input" placeholder="ê³µì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />

      <select id="lang" class="input">
        <option value="kr">í•œêµ­ì–´</option>
        <option value="en">English</option>
      </select>

      <h3>ë‚´ìš©</h3>
      <div id="editor" style="border:1px solid #ddd; border-radius:8px;"></div>

      <h3 style="margin-top:25px;">ëŒ€í‘œ ì´ë¯¸ì§€</h3>
      <input type="file" id="image" accept="image/*" class="input">

      <div id="preview"></div>

      <button type="submit" class="btn btn-primary" style="margin-top:20px;">
        ê³µì§€ ë“±ë¡
      </button>

    </div>
  </form>

</div>

<!-- ê´€ë¦¬ì ì¸ì¦ / ì‚¬ì´ë“œë°” -->
<script src="/kr/admin/js/common_auth.js"></script>
<script src="/kr/admin/js/sidebar.js"></script>

<!-- Toast UI Editor -->
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<script>
/* -------------------------------
   ğŸ” ê¶Œí•œ ì²´í¬ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
-------------------------------- */
(function () {
  requireAdminOrEditor();
  document.getElementById("logoutBtn").addEventListener("click", logout);
})();

/* -------------------------------
   âœï¸ Toast UI Editor
-------------------------------- */
const editor = new toastui.Editor({
  el: document.querySelector('#editor'),
  height: '500px',
  initialEditType: 'wysiwyg',
  previewStyle: 'vertical'
});

/* -------------------------------
   ğŸ–¼ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
-------------------------------- */
document.getElementById("image").addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const url = URL.createObjectURL(file);
  document.getElementById("preview").innerHTML = `<img src="${url}" alt="preview">`;
});

/* -------------------------------
   ğŸ“Œ ê³µì§€ ë“±ë¡ ìš”ì²­
-------------------------------- */
document.getElementById("noticeForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const title = document.getElementById("title").value.trim();
  const lang = document.getElementById("lang").value;
  const content = editor.getHTML();
  const imageFile = document.getElementById("image").files[0];

  if (!title) return alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");
  if (!content.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
  if (!imageFile) return alert("ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.");

  const formData = new FormData();
  formData.append("title", title);
  formData.append("content", content);
  formData.append("category", "notice");
  formData.append("lang", lang);
  formData.append("images", imageFile);

  const token = localStorage.getItem("token");

  const res = await fetch("/api/posts/notice/create", {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`
    },
    body: formData
  });

  const json = await res.json();

  if (res.ok) {
    alert("ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    location.href = "/kr/admin/notice-list.html";
  } else {
    console.error(json);
    alert("ë“±ë¡ ì˜¤ë¥˜: " + (json.message || "ì„œë²„ ì˜¤ë¥˜"));
  }
});
</script>

</body>
</html>
