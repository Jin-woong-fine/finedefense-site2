<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>자료 등록 | 관리자</title>
  <link rel="stylesheet" href="/kr/admin/css/admin.css">
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">

  <style>
    .form-wrap { max-width:900px; margin:20px auto; }
    .form-item { margin-bottom:20px; }
    label { font-weight:600; display:block; margin-bottom:6px; }
    input, select { padding:8px; width:100%; }
    .btn-blue { padding:10px 18px; background:#0f2679;color:white;border-radius:6px;cursor:pointer; }
    .home-btn { padding:8px 12px; background:#0f2679; color:#fff; border:none; border-radius:6px; cursor:pointer; }
  </style>
</head>

<body>

<div id="sidebar"></div>

<div class="main">

  <!-- ⭐ TOPBAR 추가 -->
  <div class="topbar">
    <div class="title">자료 등록</div>
    <div>
      <button class="home-btn" onclick="location.href='/kr/index.html'">홈으로</button>
    </div>
  </div>

  <div class="form-wrap">

    <div class="form-item">
      <label>제목</label>
      <input type="text" id="title">
    </div>

    <div class="form-item">
      <label>카테고리</label>
      <select id="category">
        <option value="kr_catalog">한국어 종합카탈로그</option>
        <option value="en_catalog">영어 종합카탈로그</option>
        <option value="company">회사 소개서</option>
        <option value="etc">기타</option>
      </select>
    </div>

    <div class="form-item">
      <label>언어</label>
      <select id="lang">
        <option value="kr">한국어</option>
        <option value="en">영어</option>
      </select>
    </div>

    <div class="form-item">
      <label>정렬순서</label>
      <input type="number" id="sort_order" value="9999">
    </div>

    <div class="form-item">
      <label>본문</label>
      <div id="editor"></div>
    </div>

    <div class="form-item">
      <label>첨부파일</label>
      <input type="file" id="files" multiple>
    </div>

    <button class="btn-blue" onclick="save()">등록</button>
  </div>
</div>

<script src="/kr/admin/js/sidebar.js"></script>
<script src="/kr/admin/js/common_auth.js"></script>
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

<script>
  loadSidebar("downloads");

  const editor = new toastui.Editor({
    el: document.querySelector("#editor"),
    height: "500px",
    initialEditType: "wysiwyg",
    previewStyle: "vertical",
    hooks: {
      async addImageBlobHook(blob, callback) {
        const fd = new FormData();
        fd.append("image", blob);
        const res = await fetch("/api/uploads/editor/image", {
          method:"POST",
          body: fd
        });
        const out = await res.json();
        callback(out.url, "image");
      }
    }
  });

  async function save() {
    const fd = new FormData();
    fd.append("title", document.getElementById("title").value);
    fd.append("category", document.getElementById("category").value);
    fd.append("lang", document.getElementById("lang").value);
    fd.append("sort_order", document.getElementById("sort_order").value);
    fd.append("content", editor.getHTML());

    const files = document.getElementById("files").files;
    for (const f of files) fd.append("files", f);

    const res = await fetch("/api/downloads/create", {
      method: "POST",
      headers: { Authorization: "Bearer " + localStorage.getItem("token") },
      body: fd
    });

    const out = await res.json();
    if (res.ok) {
      alert("등록되었습니다.");
      location.href = "downloads-list.html";
    } else alert(out.message);
  }
</script>

</body>
</html>
