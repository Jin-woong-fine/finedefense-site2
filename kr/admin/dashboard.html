<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | Fine Defense</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ê³µí†µ ê´€ë¦¬ì CSS -->
  <link rel="stylesheet" href="./css/admin.css">

  <!-- ğŸ”¥ ê³µí†µ ì¸ì¦ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="./js/common_auth.js"></script>

  <!-- ğŸ”¥ ëŒ€ì‹œë³´ë“œëŠ” ëª¨ë“  ë¡œê·¸ì¸ ì‚¬ìš©ì í—ˆìš© -->
  <script>
    requireAnyUser();  
  </script>
</head>

<body>

  <!-- ğŸ”µ ì‚¬ì´ë“œë°” -->
  <div id="sidebar"></div>

  <!-- ğŸ”µ ë©”ì¸ -->
  <div class="main">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>

      <div style="display:flex; align-items:center; gap:12px;">
        <!-- í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ -->
        <div class="topbar-user" id="topbarUser">
          <span id="topbarUserName">ê´€ë¦¬ì</span>
          â–¾
          <!-- âš ï¸ ë™ì  ìƒì„±ë  dropdown, HTML ë¹„ì›Œë‘”ë‹¤ -->
          <div class="user-dropdown" id="userDropdown"></div>
        </div>

        <button onclick="location.href='../index.html'">í™ˆìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <section class="stats-container">
      <div class="stat-card">
        <h3>ì´ë²ˆë‹¬ ì¡°íšŒìˆ˜</h3>
        <p id="thisMonthViews" class="stat-value">0</p>
      </div>
      <div class="stat-card">
        <h3>ì§€ë‚œë‹¬ ì¡°íšŒìˆ˜</h3>
        <p id="lastMonthViews" class="stat-value">0</p>
      </div>
      <div class="stat-card">
        <h3>ì¦ê°€ìœ¨</h3>
        <p id="growthRate" class="stat-value">0%</p>
      </div>
      <div class="stat-card">
        <h3>ì „ì²´ ê²Œì‹œë¬¼ ìˆ˜</h3>
        <p id="totalPosts" class="stat-value">0</p>
      </div>
    </section>

    <!-- ì›”ë³„ ì¡°íšŒìˆ˜ ê·¸ë˜í”„ -->
    <section class="panel">
      <h2>ì›”ë³„ ì¡°íšŒìˆ˜ ê·¸ë˜í”„</h2>
      <canvas id="monthlyChart" style="max-height:350px;"></canvas>
    </section>

    <!-- TOP 5 ê²Œì‹œë¬¼ -->
    <section class="panel">
      <h2>ì¡°íšŒìˆ˜ TOP 5 ê²Œì‹œë¬¼</h2>
      <ul id="topPostsList"></ul>
    </section>

    <!-- ìµœê·¼ ë“±ë¡ ì œí’ˆ -->
    <section class="panel">
      <h2>ìµœê·¼ ë“±ë¡ ì œí’ˆ</h2>
      <div id="recentProducts"></div>
    </section>

  </div>

  <!-- ğŸ”µ ë‚˜ë¨¸ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="./js/sidebar.js"></script>
  <script src="./js/dashboard_core.js"></script>

  <script>
    // ğŸ”µ ì‚¬ì´ë“œë°” ë¡œë“œ
    loadSidebar("dashboard");

    // ğŸ”µ ìƒë‹¨ ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ ê¶Œí•œë³„ ìƒì„±
    (function initTopbarUser() {
      const name = localStorage.getItem("name") || "ì‚¬ìš©ì";
      const role = localStorage.getItem("role");
      const nameSpan = document.getElementById("topbarUserName");
      const dropdown = document.getElementById("userDropdown");
      const userBox = document.getElementById("topbarUser");

      if (nameSpan) nameSpan.textContent = name;

      // ğŸ”¥ dropdown ë™ì  ìƒì„±
      let html = `
        <a href="/kr/admin/user_profile.html">ë‚´ í”„ë¡œí•„</a>
      `;

      // admin + superadmin ë§Œ "ì‚¬ìš©ì ê´€ë¦¬"
      if (role === "admin" || role === "superadmin") {
        html += `
          <a href="/kr/admin/users.html">ì‚¬ìš©ì ê´€ë¦¬</a>
        `;
      }

      html += `
        <a href="javascript:void(0);" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
      `;

      dropdown.innerHTML = html;

      // í† ê¸€ ê¸°ëŠ¥
      userBox.addEventListener("click", (e) => {
        e.stopPropagation();
        dropdown.style.display = 
          dropdown.style.display === "block" ? "none" : "block";
      });

      document.addEventListener("click", () => {
        dropdown.style.display = "none";
      });
    })();
  </script>

</body>
</html>
