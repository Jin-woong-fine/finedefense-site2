<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 대시보드 | Fine Defense</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- 공통 관리자 CSS -->
  <link rel="stylesheet" href="./css/admin.css">

  <!-- 인증 -->
  <script src="./js/common_auth.js"></script>

  <!-- 세션 매니저 -->
  <script type="module" src="/js/session_manager.js"></script>
  <script type="module" src="./js/dashboard_session_timer.js"></script>

  <!-- 패널 설명용 CSS -->
  <style>
    .panel-desc {
      font-size: 0.78rem;
      color: #777;
      margin-top: -6px;
      margin-bottom: 12px;
      line-height: 1.4;
    }
  </style>
</head>

<body data-admin-page="dashboard">

<div id="sidebar"></div>

<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="title">관리자 대시보드</div>

    <div style="display:flex; align-items:center; gap:12px;">
      <span id="session-timer" class="session-timer">세션 계산중...</span>

      <div class="topbar-user" id="topbarUser">
        <span id="topbarUserName">관리자</span> ▾
        <div class="user-dropdown" id="userDropdown"></div>
      </div>

      <button onclick="location.href='../index.html'">홈으로</button>
    </div>
  </div>

  <!-- 🔷 KPI -->
  <section class="stats-row">

    <div class="stat-card">
      <h3>오늘 방문자 (UV)</h3>
      <p class="panel-desc">중복 방문을 제거한 오늘 기준 고유 방문자 수(UV)입니다.</p>
      <p id="uvToday" class="stat-value">0</p>
    </div>

    <div class="stat-card">
      <h3>이번달 방문자 (UV)</h3>
      <p class="panel-desc">이번 달 누적 고유 방문자 수(UV)입니다.</p>
      <p id="uvMonth" class="stat-value">0</p>
    </div>

    <div class="stat-card">
      <h3>방문자 증가율(월)</h3>
      <p class="panel-desc">전월 대비 월간 고유 방문자 수(UV) 증감 비율입니다.</p>
      <p id="uvGrowth" class="stat-value">0%</p>
    </div>

    <div class="stat-card">
      <h3>오늘 페이지뷰 (PV)</h3>
      <p class="panel-desc">오늘 발생한 전체 페이지 조회 수(PV)입니다.</p>
      <p id="pvToday" class="stat-value">0</p>
    </div>

    <div class="stat-card">
      <h3>이번달 페이지뷰 (PV)</h3>
      <p class="panel-desc">이번 달 누적 페이지 조회 수(PV)입니다.</p>
      <p id="pvMonth" class="stat-value">0</p>
    </div>

    <div class="stat-card">
      <h3>페이지뷰 증가율(월)</h3>
      <p class="panel-desc">전월 대비 월간 페이지 조회 수(PV) 증감 비율입니다.</p>
      <p id="pvGrowth" class="stat-value">0%</p>
    </div>

  </section>

  <!-- 🔷 트래픽 -->
  <section class="grid-2">
    <div class="panel">
      <h2>최근 30일 방문자</h2>
      <p class="panel-desc">최근 30일 기준 일별 고유 방문자 수(UV) 추이입니다.</p>
      <canvas id="dailyChart"></canvas>
    </div>

    <div class="panel">
      <h2>디바이스 비율</h2>
      <p class="panel-desc">최근 30일 기준 전체 트래픽(조회) 발생 건수의 디바이스 유형 비율입니다.</p>
      <canvas id="deviceChart"></canvas>
    </div>
  </section>

  <!-- 🔷 국가 / 유입 -->
  <section class="grid-2">
    <div class="panel">
      <h2>국가별 방문자</h2>
      <p class="panel-desc">최근 30일 기준 전체 조회(이벤트) 발생 건수의 디바이스 유형 비율입니다.</p>
      <canvas id="countryChart"></canvas>
    </div>

    <div class="panel">
      <h2>유입경로 TOP 5</h2>
      <p class="panel-desc">최근 30일 기준 방문자의 주요 유입 경로 상위 항목입니다.</p>
      <ul id="referrerList"></ul>
    </div>
  </section>

  <!-- 🔷 콘텐츠 -->
  <section class="grid-2">
    <div class="panel">
      <h2>조회수 TOP 5 게시물</h2>
      <p class="panel-desc">페이지 조회 수(PV) 기준 상위 게시물입니다.</p>
      <ul id="topPostsList"></ul>
    </div>

    <div class="panel">
      <h2>페이지뷰 TOP 5</h2>
      <p class="panel-desc">페이지 조회 수(PV) 기준 상위 페이지입니다.</p>
      <ul id="pageViewList"></ul>
    </div>
  </section>

  <!-- 🔷 다운로드 / 제품 -->
  <section class="grid-2">
    <div class="panel">
      <h2>자료실 다운로드 TOP 5</h2>
      <p class="panel-desc">파일 다운로드 횟수 기준 상위 자료입니다.</p>
      <ul id="downloadTopList"></ul>
    </div>

    <div class="panel">
      <h2>최근 등록 제품</h2>
      <p class="panel-desc">최근 관리자에 의해 등록된 제품 목록입니다.</p>
      <div id="recentProducts"></div>
    </div>
  </section>

  <!-- 🔷 카탈로그 -->
  <section class="grid-2">
    <div class="panel">
      <h2>카탈로그 조회수 TOP 5</h2>
      <p class="panel-desc">페이지 조회 수(PV) 기준 상위 카탈로그입니다.</p>
      <ul id="catalogViewTopList"></ul>
    </div>

    <div class="panel">
      <h2>카탈로그 다운로드 TOP 5</h2>
      <p class="panel-desc">파일 다운로드 횟수 기준 상위 카탈로그입니다.</p>
      <ul id="catalogDownloadTopList"></ul>
    </div>
  </section>

</div>

<script src="./js/sidebar.js"></script>
<script src="./js/dashboard_core.js"></script>
<script src="./js/topbar_user_menu.js"></script>

<script>
requireLogin();
</script>

</body>
</html>
