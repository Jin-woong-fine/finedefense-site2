<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¹´íƒˆë¡œê·¸ | Fine Defense</title>

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <style>
    .catalog-container {
      max-width: 1200px;
      margin: 60px auto 100px;
      padding: 0 20px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 20px;
    }

    .card {
      padding: 18px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.07);
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover { transform: translateY(-3px); }

    .thumb {
      width: 100%;
      max-width: 180px;
      height: 250px;
      object-fit: contain;
      background: #f5f5f5;
      margin: 0 auto 15px;
      border-radius: 6px;
      border:1px solid #ddd;
    }

    .title {
      font-size: 1.1rem;
      font-weight: 700;
      min-height: 48px;
      margin-bottom: 12px;
    }

    .btn-download {
      background: #0f2679;
      color: #fff;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-top: 10px;
    }

    /* ==========================
       PDF VIEWER MODAL
    ========================== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      z-index: 9999;
    }
    .modal-content {
      background: #fff;
      width: 90%;
      height: 90%;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .modal-header {
      background:#0f2679;
      color:white;
      padding: 10px 16px;
      font-size:1rem;
      font-weight:600;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .modal-close {
      cursor:pointer;
      font-size:1.4rem;
      font-weight:bold;
    }
    .modal-body {
      flex:1;
      overflow:hidden;
    }
    .pdf-frame {
      width: 100%;
      height: calc(100% - 50px); /* í—¤ë” ë†’ì´ ì œì™¸ */
    }

    .modal-footer {
      padding:10px;
      text-align:right;
      background:#f5f5f5;
    }

    .viewer-btn {
      cursor: pointer;
      font-size: 1.2rem;
      padding: 4px 8px;
      border-radius: 6px;
      transition: 0.2s;
      color:white;
    }
    .viewer-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    /* === ëª¨ë‹¬ ì°½ í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • === */
    .modal-content {
      resize: both;        /* ê°€ë¡œë‚˜ ì„¸ë¡œ ë‘˜ ë‹¤ ì¡°ì ˆ ê°€ëŠ¥ */
      overflow: auto;      /* ë‚´ë¶€ ì»¨í…ì¸ ê°€ ë„˜ì¹  ë•Œ ìŠ¤í¬ë¡¤ */
      max-width: 95vw;     /* ì°½ì´ ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒ ë°©ì§€ */
      max-height: 95vh;
      min-width: 400px;    /* ìµœì†Œ í¬ê¸° */
      min-height: 300px;
    }


    .catalog-section-title {
      margin: 60px 0 20px;
      font-size: 1.6rem;
      font-weight: 800;
      color: #0f2679;
      border-left: 6px solid #0f2679;
      padding-left: 14px;
    }



  </style>
</head>

<body>

  <!-- ê´€ë¦¬ì ì„¸ì…˜ë°” (ì •í™•í•œ ID ë¶€ì—¬) -->
  <div id="adminBarContainer" data-include="/kr/components/admin-session-bar.html"></div>

  <!-- ê³µí†µ í—¤ë” -->
  <div id="headerContainer" data-include="/kr/components/header.html"></div>

<section class="sub-banner">
  <img src="/img/sub-banners/subbanner_pr.png" alt="ì¹´íƒˆë¡œê·¸">
  <div class="banner-text">
      <h1>í™ë³´ì„¼í„°</h1>
      <p>í™”ì¸ë””íœìŠ¤ì˜ ìµœì‹  ì†Œì‹ê³¼ í™ë³´ ìë£Œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  </div>
</section>

<div class="breadcrumb">
  <a href="/kr/index.html">í™ˆ</a> &gt;
  <span class="crumb crumb-level1">í™ë³´ì„¼í„°</span> &gt;
  <span class="crumb crumb-level2">ì¹´íƒˆë¡œê·¸</span>
  <div id="side-tabs"></div>
</div>

<div class="catalog-container">

  <div class="catalog-section">
    <div class="catalog-section-title">í•œêµ­ì–´ ì¢…í•© ì¹´íƒˆë¡œê·¸</div>
    <div id="kr_catalog" class="card-grid"></div>
  </div>

  <div class="catalog-section">
    <div class="catalog-section-title">ì˜ì–´ ì¢…í•© ì¹´íƒˆë¡œê·¸</div>
    <div id="en_catalog" class="card-grid"></div>
  </div>

  <div class="catalog-section">
    <div class="catalog-section-title">íšŒì‚¬ ì†Œê°œì„œ</div>
    <div id="company_intro" class="card-grid"></div>
  </div>

  <div class="catalog-section">
    <div class="catalog-section-title">ê¸°íƒ€</div>
    <div id="etc" class="card-grid"></div>
  </div>

</div>

    <!-- ê³µí†µ í‘¸í„° -->
    <div data-include="/kr/components/footer.html"></div>




<script>
/* =====================================================
   ğŸ“¦ CATALOG LIST + PDF VIEWER (FINAL)
===================================================== */

const categories = ["kr_catalog", "en_catalog", "company_intro", "etc"];

// ì´ˆê¸° ë¡œë”©
document.addEventListener("DOMContentLoaded", () => {
  categories.forEach(loadCategory);
});

/* =====================================================
   ğŸ“„ ì¹´í…Œê³ ë¦¬ ë¡œë”©
===================================================== */
async function loadCategory(category) {
  const container = document.getElementById(category);
  if (!container) return;

  const section = container.closest(".catalog-section");

  try {
    const res = await fetch(`/api/catalog/list?category=${category}`);
    if (!res.ok) throw new Error("API Error");

    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      section.style.display = "none";
      return;
    }

    container.innerHTML = "";

    data.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";

      card.addEventListener("click", () => {
        openPdf(item.id, item.file_url, item.title);
      });

      card.innerHTML = `
        <img
          src="${item.thumb_url || "/img/common/pdf-placeholder.png"}"
          class="thumb"
          onerror="this.src='/img/common/pdf-placeholder.png'"
        >
        <div class="title">${escapeHtml(item.title)}</div>
      `;

      if (item.file_url) {
        const btn = document.createElement("a");
        btn.className = "btn-download";
        btn.textContent = "ë‹¤ìš´ë¡œë“œ";
        btn.href = item.file_url;
        btn.download = "";

        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          increaseDownload(item.id);
        });

        card.appendChild(btn);
      } else {
        const span = document.createElement("span");
        span.style.color = "#777";
        span.textContent = "íŒŒì¼ ì—†ìŒ";
        card.appendChild(span);
      }

      container.appendChild(card);
    });

  } catch (err) {
    console.error("[catalog]", err);
    section.style.display = "none";
  }
}

/* =====================================================
   ğŸ” PDF VIEW + ì¡°íšŒìˆ˜
===================================================== */
let currentZoom = 1;
let currentRotate = 0;

function openPdf(id, url, title) {
  if (!url) {
    alert("íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // âœ… ì¡°íšŒìˆ˜ ì¦ê°€ â€” ëª¨ë‹¬ ì—´ë¦´ ë•Œ ë‹¨ 1íšŒ
  fetch(`/api/catalog/view/${id}`, {
    method: "POST"
  }).then(res => {
    if (!res.ok) {
      console.error("ì¡°íšŒìˆ˜ ì¦ê°€ ì‹¤íŒ¨:", id);
    }
  }).catch(err => {
    console.error("ì¡°íšŒìˆ˜ fetch ì˜¤ë¥˜:", err);
  });

  // âœ… PDF í‘œì‹œ
  document.getElementById("pdfFrame").src = url;
  document.getElementById("pdfTitle").textContent = title;
  document.getElementById("pdfDownload").href = url;

  currentZoom = 1;
  currentRotate = 0;
  applyTransform();

  document.getElementById("pdfModal").style.display = "flex";
}

function closePdf() {
  document.getElementById("pdfModal").style.display = "none";
  document.getElementById("pdfFrame").src = "";
}

/* =====================================================
   ğŸ“¥ ë‹¤ìš´ë¡œë“œ ìˆ˜ ì¦ê°€
===================================================== */
function increaseDownload(id) {
  fetch(`/api/catalog/download/${id}`, { method: "POST" }).catch(() => {});
}

/* =====================================================
   ğŸ” í™•ëŒ€ / ì¶•ì†Œ / íšŒì „
===================================================== */
function zoomIn() {
  currentZoom += 0.1;
  applyTransform();
}

function zoomOut() {
  if (currentZoom > 0.3) {
    currentZoom -= 0.1;
    applyTransform();
  }
}

function rotatePdf() {
  currentRotate = (currentRotate + 90) % 360;
  applyTransform();
}

function applyTransform() {
  const frame = document.getElementById("pdfFrame");
  frame.style.transform = `scale(${currentZoom}) rotate(${currentRotate}deg)`;
  frame.style.transformOrigin = "center center";
}

/* =====================================================
   ğŸ–¥ ì „ì²´í™”ë©´
===================================================== */
function toggleFullScreen() {
  const frame = document.getElementById("pdfFrame");

  if (!document.fullscreenElement) {
    frame.requestFullscreen().catch(err => {
      console.error("ì „ì²´í™”ë©´ ì‹¤íŒ¨:", err);
    });
  } else {
    document.exitFullscreen();
  }
}

/* =====================================================
   ğŸ” XSS ë°©ì§€
===================================================== */
function escapeHtml(text = "") {
  return text.replace(/[&<>"']/g, m => ({
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#39;"
  }[m]));
}
</script>





    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/js/include.js"></script>
    <script src="/js/session_timer.js"></script>
    <script src="/js/language.js"></script>
    <script src="/js/nav.js"></script>



</body>
</html>
