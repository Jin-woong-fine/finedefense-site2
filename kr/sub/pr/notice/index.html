<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê³µì§€ì‚¬í•­ | Fine Defense</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ê³µí†µ CSS -->
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <style>
    .notice-wrap {
      max-width: 1000px;
      margin: 50px auto 100px;
    }

    .top-row {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 15px;
      gap: 10px;
    }

    select, input {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    .btn-search {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      background: #0f2679;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
    }

    table.notice-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 3px 12px rgba(0,0,0,0.06);
    }

    table.notice-table th,
    table.notice-table td {
      padding: 12px 14px;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
    }

    table.notice-table th {
      background: #f5f7fb;
      font-weight: 600;
      text-align: center;
    }

    table.notice-table td.title {
      text-align: left;
    }

    table.notice-table tr:hover td {
      background: #fafbff;
      cursor: pointer;
    }

    .no-data {
      text-align: center;
      padding: 40px;
      color: #777;
    }

    .pagination {
      margin-top: 24px;
      display: flex;
      justify-content: center;
      gap: 6px;
    }

    .pagination button {
      border: 1px solid #ccc;
      background: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .pagination button.active {
      background: #0f2679;
      color: #fff;
      border-color: #0f2679;
    }
  </style>
</head>

<body>

  <!-- ê´€ë¦¬ì ì„¸ì…˜ë°” (ì •í™•í•œ ID ë¶€ì—¬) -->
  <div id="adminBarContainer" data-include="/kr/components/admin-session-bar.html"></div>

  <!-- ê³µí†µ í—¤ë” -->
  <div id="headerContainer" data-include="/kr/components/header.html"></div>

<section class="sub-banner">
  <img src="/img/sub-banners/pr-1_v2.jpg" alt="ê³µì§€ì‚¬í•­">
  <div class="banner-text">
    <h1>í™ë³´ì„¼í„°</h1>
    <p>í™”ì¸ë””íœìŠ¤ì˜ ìµœì‹  ì†Œì‹ê³¼ í™ë³´ ìë£Œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  </div>
</section>

<div class="breadcrumb">
  <a href="/kr/index.html">í™ˆ</a> &gt;
  <span class="crumb crumb-level1">í™ë³´ì„¼í„°</span> &gt;
  <span class="crumb crumb-level2">ê³µì§€ì‚¬í•­</span>
  <div id="side-tabs"></div>
</div>

<div class="notice-wrap">

  <div class="top-row">
    <select id="langFilter">
      <option value="kr">í•œêµ­ì–´</option>
      <option value="en">ì˜ì–´</option>
      <option value="all">ì „ì²´ ì–¸ì–´</option>
    </select>

    <input type="text" id="search" placeholder="ì œëª© ê²€ìƒ‰">
    <button class="btn-search" onclick="reloadNotices()">ê²€ìƒ‰</button>
  </div>

  <table class="notice-table">
    <thead>
      <tr>
        <th style="width:70px;">ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th style="width:120px;">ì‘ì„±ì¼</th>
        <th style="width:80px;">ì¡°íšŒìˆ˜</th>
      </tr>
    </thead>
    <tbody id="noticeBody">
      <tr><td colspan="4" class="no-data">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>
    </tbody>
  </table>

  <div class="pagination" id="pagination"></div>
</div>

    <!-- ê³µí†µ í‘¸í„° -->
    <div data-include="/kr/components/footer.html"></div>


<script>
  let currentPage = 1;
  const pageSize = 10;  // í•œ í˜ì´ì§€ 10ê°œ

  document.addEventListener("DOMContentLoaded", () => {
    loadNotices(1);
  });

  function reloadNotices() {
    loadNotices(1);
  }

  async function loadNotices(page) {
    currentPage = page;

    const lang = document.getElementById("langFilter").value;
    const search = document.getElementById("search").value.trim();

    // ğŸ”¥ posts_common.js ê·œê²©ì— ë§ëŠ” ì—”ë“œí¬ì¸íŠ¸
    let url = `/api/posts/list/notice?lang=${lang}&page=${page}&pageSize=${pageSize}`;

    // (ì„ íƒ) ê²€ìƒ‰ ê¸°ëŠ¥ì„ posts_commonì— ë¶™ì˜€ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ì¿¼ë¦¬ ì¶”ê°€
    if (search) {
      url += `&search=${encodeURIComponent(search)}`;
    }

    const res = await fetch(url);
    const data = await res.json();

    const tbody = document.getElementById("noticeBody");
    const pagination = document.getElementById("pagination");

    if (!data.list || !data.list.length) {
      tbody.innerHTML = `
        <tr>
          <td colspan="4" class="no-data">ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
      `;
      pagination.innerHTML = "";
      return;
    }

    // ë²ˆí˜¸ ê³„ì‚° (ì „ì²´ ê¸°ì¤€ ì—­ìˆœ)
    const startIndex = data.total - (data.page - 1) * data.pageSize;

    tbody.innerHTML = data.list.map((item, idx) => {
      const no = startIndex - idx;
      const dateStr = item.created_at ? item.created_at.substring(0, 10) : "";
      const views = item.views ?? 0;

      return `
        <tr onclick="openNotice(${item.id})">
          <td style="text-align:center;">${no}</td>
          <td class="title">${item.title}</td>
          <td style="text-align:center;">${dateStr}</td>
          <td style="text-align:center;">${views}</td>
        </tr>
      `;
    }).join("");

    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
    renderPagination(data.pages, data.page);
  }

  function renderPagination(totalPages, current) {
    const p = document.getElementById("pagination");
    p.innerHTML = "";

    if (totalPages <= 1) return;

    if (current > 1) {
      p.innerHTML += `<button onclick="loadNotices(${current - 1})">ì´ì „</button>`;
    }

    for (let i = 1; i <= totalPages; i++) {
      p.innerHTML += `
        <button class="${i === current ? "active" : ""}"
                onclick="loadNotices(${i})">${i}</button>
      `;
    }

    if (current < totalPages) {
      p.innerHTML += `<button onclick="loadNotices(${current + 1})">ë‹¤ìŒ</button>`;
    }
  }

  function openNotice(id) {
    location.href = `/kr/sub/pr/notice/notice-view.html?id=${id}`;
  }
</script>


    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/js/include.js"></script>
    <script src="/js/session_timer.js"></script>
    <script src="/js/language.js"></script>
    <script src="/js/nav.js"></script>


</body>
</html>
