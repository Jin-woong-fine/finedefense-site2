<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="화인디펜스 뉴스룸" />
  <title>뉴스룸 | 화인디펜스</title>

  <!-- 공통 CSS -->
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/sub-banner.css" />

  <style>
    /* ======== 전체 리스트 레이아웃 ======== */
    .newsroom-section {
      max-width: 1200px;
      margin: 50px auto 120px;
      padding: 20px;
    }

    .newsroom-title {
      text-align: center;
      margin-bottom: 50px;
    }

    .newsroom-title h1 {
      font-size: 2.2rem;
      color: #0f2679;
      margin-bottom: 14px;
    }

    .newsroom-title p {
      color: #555;
      font-size: 1.05rem;
      line-height: 1.6;
    }

    /* ======== 카드 리스트 ======== */
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 28px;
    }

    .news-card {
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      text-decoration: none;
      color: inherit;
      transition: transform .25s, box-shadow .25s;
    }

    .news-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    }

    .news-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .news-content {
      padding: 18px 20px 25px;
    }

    .news-content h3 {
      color: #0f2679;
      font-size: 1.2rem;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .news-content p {
      color: #555;
      font-size: 0.92rem;
      line-height: 1.55;
      margin-bottom: 14px;
      height: 45px;
      overflow: hidden;
    }

    .news-date {
      font-size: 0.85rem;
      color: #999;
    }
  </style>
</head>

<body>

  <div id="header"></div>

  <!-- 배너 -->
  <section class="sub-banner">
    <img src="/img/sub-banners/pr-1_v2.jpg" alt="홍보센터 배너" />
    <div class="banner-text">
      <h1>홍보센터</h1>
      <p>화인디펜스의 기술과 활동 소식을 한 자리에서 만나보세요.</p>
    </div>
  </section>

  <!-- breadcrumb -->
  <div class="breadcrumb">
    <a href="/">홈</a> &gt;
    <span class="crumb crumb-level1">홍보센터</span> &gt;
    <span class="crumb crumb-level2">뉴스룸</span>
    <div id="side-tabs" class="side-tabs"></div>
  </div>

  <!-- 뉴스룸 -->
  <section class="newsroom-section">
    <div class="newsroom-title">
      <h1>화인디펜스 뉴스룸</h1>
      <p>보도자료 · 기술자료 · 전시회 소식 등 다양한 업데이트를 확인해보세요.</p>
    </div>

    <div id="newsList" class="news-grid">
      <p style="grid-column:1/-1;text-align:center;color:#666;">뉴스를 불러오는 중입니다...</p>
    </div>
  </section>

  <div id="footer"></div>

  <script src="/js/nav.js"></script>
  <script src="/js/language.js"></script>

  <!-- ======== 뉴스 불러오기 스크립트 ======== -->
  <script>
    const API_URL = "http://localhost:3000";

    async function loadNews() {
      const list = document.getElementById("newsList");

      try {
        const res = await fetch(`${API_URL}/api/posts/news?lang=kr`);
        const posts = await res.json();

        if (!posts.length) {
          list.innerHTML = "<p style='grid-column:1/-1;text-align:center;color:#999;'>등록된 뉴스가 없습니다.</p>";
          return;
        }

        // 대표 이미지 우선순위:
        // 1) post.main_image
        // 2) post.images[0] (post_images 테이블)
        // 3) placeholder
        list.innerHTML = posts.map(p => {
          const img = p.main_image
            ? API_URL + p.main_image
            : (p.images?.length ? API_URL + p.images[0] : "/img/newsroom/newsroom-placeholder_v2.png");

          const cleanText = p.content.replace(/<[^>]+>/g, '').slice(0, 80);

          return `
            <a href="/kr/sub/pr/newsroom/post_template.html?id=${p.id}" class="news-card">
              <img src="${img}" alt="${p.title}">
              <div class="news-content">
                <h3>${p.title}</h3>
                <p>${cleanText}...</p>
                <span class="news-date">${new Date(p.created_at).toLocaleDateString()}</span>
              </div>
            </a>
          `;
        }).join("");

      } catch (err) {
        console.error(err);
        list.innerHTML = "<p style='grid-column:1/-1;color:red;text-align:center;'>뉴스를 불러오는 중 오류 발생.</p>";
      }
    }

    loadNews();
  </script>

</body>
</html>
