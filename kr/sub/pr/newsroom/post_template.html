<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="í™”ì¸ë””íœìŠ¤ ê²Œì‹œë¬¼ ìƒì„¸í˜ì´ì§€">
  <title>ê²Œì‹œë¬¼ ìƒì„¸ë³´ê¸° | í™”ì¸ë””íœìŠ¤</title>

  <!-- ê³µí†µ CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f5f6fa;
      margin: 0;
    }

    .page-wrap {
      padding: 40px 16px 80px;
    }

    .news-post-container {
      max-width: 1080px;
      margin: 0 auto;
    }

    /* ìƒë‹¨ ì •ë³´ ì˜ì—­ (ì‚¼ì„± ë‰´ìŠ¤ë£¸ì²˜ëŸ¼) */
    .post-top-meta {
      margin-bottom: 18px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .post-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .badge-category {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: #0f2679;
      color: #fff;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .badge-lang {
      display: inline-block;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid #d0d4f0;
      color: #4b5563;
      font-size: 0.75rem;
    }

    .post-meta-right {
      font-size: 0.85rem;
      color: #6b7280;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }

    .meta-dot::before {
      content: "â€¢";
      margin: 0 4px;
      color: #9ca3af;
    }

    .meta-label {
      color: #9ca3af;
      margin-right: 4px;
    }

    /* ì œëª© */
    .post-header {
      margin-bottom: 28px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 24px;
    }

    .post-header h1 {
      color: #111827;
      font-size: 2rem;
      line-height: 1.4;
      margin: 0 0 10px;
      word-break: keep-all;
    }

    /* ê³µìœ  ë²„íŠ¼ (í˜•ì‹ë§Œ, ì‹¤ì œ ê¸°ëŠ¥ì€ ë‚˜ì¤‘ì— í™•ì¥ ê°€ëŠ¥) */
    .share-box {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 6px;
    }

    .share-btn {
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      border-radius: 999px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .share-btn:hover {
      background: #eef2ff;
    }

    /* ëŒ€í‘œ ì´ë¯¸ì§€ */
    .post-hero {
      margin: 24px 0 32px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(15, 38, 121, 0.12);
      text-align: center;
    }


    .post-hero img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;  /* ì´ë¯¸ì§€ ì „ì²´ ë³´ì´ê¸° */
      border-radius: 12px;
      max-height: 600px;
    }


    /* ë³¸ë¬¸ */
    .post-content-wrap {
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 32px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      border: 1px solid #e5e7eb;
    }

    .post-content {
      color: #111827;
      line-height: 1.9;
      font-size: 0.98rem;
      word-break: break-word;
    }

    .post-content p {
      margin: 0 0 1rem;
    }

    .post-content h1,
    .post-content h2,
    .post-content h3 {
      margin-top: 1.6rem;
      margin-bottom: 0.8rem;
      color: #111827;
    }

    .post-content img {
      max-width: 100%;
      border-radius: 8px;
      margin: 16px 0;
    }

    .post-content ul,
    .post-content ol {
      padding-left: 1.2rem;
      margin-bottom: 1rem;
    }

    /* íƒœê·¸/ë°”ë‹¥ ë©”íƒ€ */
    .post-footer-meta {
      margin-top: 28px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.85rem;
      color: #6b7280;
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 0.8rem;
      color: #4b5563;
    }

    /* ì´ì „/ë‹¤ìŒ ê¸€ */
    .post-nav {
      max-width: 1080px;
      margin: 30px auto 0;
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }

    .post-nav-item {
      background: #ffffff;
      border-radius: 10px;
      padding: 12px 16px;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .post-nav-item:hover {
      border-color: #0f2679;
      box-shadow: 0 3px 10px rgba(15,38,121,0.08);
    }

    .post-nav-label {
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .post-nav-title {
      font-size: 0.9rem;
      color: #111827;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ê´€ë ¨ ê²Œì‹œë¬¼ */
    .related-wrap {
      max-width: 1080px;
      margin: 40px auto 0;
    }

    .related-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 12px;
      color: #111827;
    }

    .related-list {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }

    .related-card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      cursor: pointer;
      transition: 0.15s;
    }

    .related-card:hover {
      border-color: #0f2679;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    }

    .related-cat {
      font-size: 0.72rem;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    .related-title-text {
      font-size: 0.9rem;
      color: #111827;
      line-height: 1.4;
      height: 2.8em;
      overflow: hidden;
    }

    .related-date {
      margin-top: 4px;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    /* ë²„íŠ¼ ì˜ì—­ */
    .post-bottom-actions {
      max-width: 1080px;
      margin: 30px auto 0;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: #0f2679;
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
    }

    .back-btn:hover {
      background: #1b348f;
    }

    /* ê´€ë¦¬ì ë°•ìŠ¤ */
    #adminEditBox {
      display:none;
    }

    #adminEditBox button {
      background:#1b7fcb;
      color:white;
      border:none;
      padding:8px 14px;
      border-radius:6px;
      cursor:pointer;
      font-size:0.85rem;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 900px) {
      .post-content-wrap {
        padding: 20px 18px 28px;
      }
      .news-post-container {
        margin: 0 auto;
      }
      .post-nav {
        grid-template-columns: 1fr;
      }
      .related-list {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 640px) {
      .page-wrap {
        padding: 24px 10px 60px;
      }
      .post-header h1 {
        font-size: 1.5rem;
      }
      .related-list {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <div id="header"></div>

  <!-- ìƒë‹¨ ë°°ë„ˆ (ê·¸ëŒ€ë¡œ ì‚¬ìš©) -->
  <section class="sub-banner">
    <img src="/img/sub-banners/pr-1_v2.jpg" alt="í™ë³´ì„¼í„° ë°°ë„ˆ">
    <div class="banner-text">
      <h1>ë‰´ìŠ¤ë£¸</h1>
      <p>í™”ì¸ë””íœìŠ¤ì˜ ì£¼ìš” ì†Œì‹ì„ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
  </section>

  <!-- breadcrumb -->
  <div class="breadcrumb">
    <a href="/">í™ˆ</a> &gt;
    <span class="crumb crumb-level1">í™ë³´ì„¼í„°</span> &gt;
    <span class="crumb crumb-level2">ë‰´ìŠ¤ë£¸</span>
    <div id="side-tabs" class="side-tabs"></div>
  </div>

  <!-- ë³¸ë¬¸ -->
  <div class="page-wrap">
    <section class="news-post-container">
      <!-- ìƒë‹¨ ë©”íƒ€ + ì œëª© -->
      <div class="post-top-meta">
        <div class="post-badge">
          <span id="postCategoryBadge" class="badge-category">ë‰´ìŠ¤ë£¸</span>
          <span id="postLangBadge" class="badge-lang">KR</span>
        </div>

        <div class="post-meta-right">
          <div>
            <span class="meta-label">ì‘ì„±ì¼</span>
            <span id="postDate"></span>
          </div>
          <div class="meta-dot">
            <span class="meta-label">ì‘ì„±ì</span>
            <span id="postAuthor">ê´€ë¦¬ì</span>
          </div>
          <div class="meta-dot">
            <span class="meta-label">ì¡°íšŒìˆ˜</span>
            <span id="postViews">0</span>
          </div>
        </div>
      </div>

      <header class="post-header">
        <h1 id="postTitle">ì œëª© ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h1>

        <div class="share-box">
          <span>ê³µìœ í•˜ê¸°</span>
          <button class="share-btn" id="shareLinkBtn">ë§í¬ ë³µì‚¬</button>
          <button class="share-btn" id="shareMailBtn">ë©”ì¼ë¡œ ê³µìœ </button>
        </div>
      </header>

      <!-- ëŒ€í‘œ ì´ë¯¸ì§€ -->
      <div id="postHero" class="post-hero" style="display:none;">
        <!-- JSì—ì„œ ì´ë¯¸ì§€ ì‚½ì… -->
      </div>

      <!-- ë³¸ë¬¸ ë°•ìŠ¤ -->
      <div class="post-content-wrap">
        <article id="postContent" class="post-content">
          <p>ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </article>

        <!-- íƒœê·¸/ì¹´í…Œê³ ë¦¬ ì •ë³´ -->
        <div class="post-footer-meta">
          <div class="post-tags">
            <span class="tag-pill" id="tagCategory">#ë‰´ìŠ¤ë£¸</span>
            <span class="tag-pill" id="tagBrand">#FineDefense</span>
          </div>
          <div id="adminEditBox">
            <button id="editPostBtn">âœ ê´€ë¦¬ì ìˆ˜ì •í•˜ê¸°</button>
          </div>
        </div>
      </div>
    </section>

    <!-- ì´ì „/ë‹¤ìŒê¸€ -->
    <section class="post-nav">
      <div id="prevPost" class="post-nav-item" style="display:none;">
        <div class="post-nav-label">ì´ì „ ê¸€</div>
        <div class="post-nav-title" id="prevPostTitle"></div>
      </div>
      <div id="nextPost" class="post-nav-item" style="display:none;">
        <div class="post-nav-label">ë‹¤ìŒ ê¸€</div>
        <div class="post-nav-title" id="nextPostTitle"></div>
      </div>
    </section>

    <!-- ê´€ë ¨ ê²Œì‹œë¬¼ -->
    <section class="related-wrap">
      <div class="related-title">ê´€ë ¨ ê²Œì‹œë¬¼</div>
      <div class="related-list" id="relatedList">
        <!-- JSë¡œ ì±„ì›€ -->
      </div>
    </section>

    <!-- í•˜ë‹¨ ë²„íŠ¼ -->
    <div class="post-bottom-actions">
      <a href="/kr/sub/pr/newsroom/newsroom.html" class="back-btn">
        â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </a>
    </div>
  </div>

  <div id="footer"></div>

  <script src="/js/nav.js"></script>
  <script src="/js/language.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // breadcrumb ì˜¤ë¥¸ìª½ íƒ­ ìˆ¨ê¸°ê¸° (í˜• ê¸°ì¡´ êµ¬ì¡° ìœ ì§€)
      const sideTabs = document.getElementById("side-tabs");
      if (sideTabs) sideTabs.style.display = "none";

      const titleEl   = document.getElementById("postTitle");
      const catBadge  = document.getElementById("postCategoryBadge");
      const langBadge = document.getElementById("postLangBadge");
      const dateEl    = document.getElementById("postDate");
      const authorEl  = document.getElementById("postAuthor");
      const viewsEl   = document.getElementById("postViews");
      const heroWrap  = document.getElementById("postHero");
      const contentEl = document.getElementById("postContent");

      const tagCategory = document.getElementById("tagCategory");

      const prevBox     = document.getElementById("prevPost");
      const nextBox     = document.getElementById("nextPost");
      const prevTitleEl = document.getElementById("prevPostTitle");
      const nextTitleEl = document.getElementById("nextPostTitle");

      const relatedList = document.getElementById("relatedList");

      const adminBox    = document.getElementById("adminEditBox");
      const editBtn     = document.getElementById("editPostBtn");

      const postIdParam = new URLSearchParams(window.location.search).get("id");
      const postId = Number(postIdParam);

      if (!postIdParam || Number.isNaN(postId)) {
        contentEl.innerHTML = "<p style='text-align:center;color:#555;'>ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.</p>";
        return;
      }

      // âœ… ì¡°íšŒìˆ˜ ì¦ê°€ (ë°±ì—”ë“œì— /api/posts/view/:id ìˆë‹¤ê³  ê°€ì •)
      fetch(`/api/posts/view/${postId}`)
        .then(res => res.json())
        .then(data => console.log("ì¡°íšŒìˆ˜ ì¦ê°€:", data))
        .catch(err => console.error("ì¡°íšŒìˆ˜ ì¦ê°€ ì˜¤ë¥˜:", err));

      // âœ… ë‰´ìŠ¤ ëª©ë¡ì—ì„œ í•´ë‹¹ ê¸€ + ì´ì „/ë‹¤ìŒ/ê´€ë ¨ê¸€ ëª¨ë‘ ì²˜ë¦¬
      loadPostAndNeighbors(postId);

      async function loadPostAndNeighbors(id) {
        try {
          const res = await fetch(`${window.location.origin}/api/posts/news?lang=kr`);
          const posts = await res.json();

          if (!Array.isArray(posts) || posts.length === 0) {
            contentEl.innerHTML = "<p>ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          const idx = posts.findIndex(p => p.id === id);
          if (idx === -1) {
            contentEl.innerHTML = "<p>ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            titleEl.textContent = "ê²Œì‹œë¬¼ ì—†ìŒ";
            return;
          }

          const post = posts[idx];

          // ğŸ”¹ ì œëª© / ì¹´í…Œê³ ë¦¬ / ì–¸ì–´ / ë‚ ì§œ / ì‘ì„±ì / ì¡°íšŒìˆ˜
          titleEl.textContent = post.title || "ì œëª© ì—†ìŒ";
          catBadge.textContent = categoryName(post.category);
          langBadge.textContent = (post.lang || "kr").toUpperCase();

          tagCategory.textContent = "#" + categoryName(post.category);

          const created = post.created_at ? new Date(post.created_at) : null;
          dateEl.textContent = created
            ? `${created.getFullYear()}.${String(created.getMonth()+1).padStart(2,"0")}.${String(created.getDate()).padStart(2,"0")}`
            : "-";

          authorEl.textContent = post.author_name || "ê´€ë¦¬ì";

          viewsEl.textContent = (post.total_views || 0).toLocaleString();

          // ğŸ”¹ ëŒ€í‘œ ì´ë¯¸ì§€
          const mainImg = post.main_image || (post.images && post.images[0]);
          if (mainImg) {
            heroWrap.style.display = "block";
            heroWrap.innerHTML = `<img src="${mainImg}" alt="ëŒ€í‘œ ì´ë¯¸ì§€">`;
          } else {
            heroWrap.style.display = "none";
          }

          // ğŸ”¹ ë³¸ë¬¸
          contentEl.innerHTML = post.content || "<p>ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>";

          // ğŸ”¹ ì´ì „ê¸€ / ë‹¤ìŒê¸€
          if (idx > 0) {
            const prevPost = posts[idx - 1];
            prevBox.style.display = "block";
            prevTitleEl.textContent = prevPost.title;
            prevBox.onclick = () => {
              location.href = `/kr/sub/pr/newsroom/post_template.html?id=${prevPost.id}`;
            };
          }

          if (idx < posts.length - 1) {
            const nextPost = posts[idx + 1];
            nextBox.style.display = "block";
            nextTitleEl.textContent = nextPost.title;
            nextBox.onclick = () => {
              location.href = `/kr/sub/pr/newsroom/post_template.html?id=${nextPost.id}`;
            };
          }

          // ğŸ”¹ ê´€ë ¨ ê²Œì‹œë¬¼ (ê°™ì€ ì¹´í…Œê³ ë¦¬ ì¤‘ì—ì„œ ìµœëŒ€ 3ê°œ)
          const related = posts
            .filter(p => p.id !== id && p.category === post.category)
            .slice(0, 3);

          relatedList.innerHTML = related
            .map(r => {
              const d = r.created_at ? new Date(r.created_at) : null;
              const dateStr = d
                ? `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,"0")}.${String(d.getDate()).padStart(2,"0")}`
                : "";
              return `
                <div class="related-card" onclick="location.href='/kr/sub/pr/newsroom/post_template.html?id=${r.id}'">
                  <div class="related-cat">${categoryName(r.category)}</div>
                  <div class="related-title-text">${r.title}</div>
                  <div class="related-date">${dateStr}</div>
                </div>
              `;
            })
            .join("");

        } catch (err) {
          console.error("âŒ ê²Œì‹œë¬¼ ë¡œë”© ì˜¤ë¥˜:", err);
          contentEl.innerHTML = "<p style='color:red;'>ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
        }
      }

      function categoryName(code) {
        switch (code) {
          case "news": return "ë‰´ìŠ¤ë£¸";
          case "notice": return "ê³µì§€ì‚¬í•­";
          case "gallery": return "ê°¤ëŸ¬ë¦¬";
          case "cert": return "ì¸ì¦ ë° íŠ¹í—ˆ";
          case "catalog": return "ì¹´íƒˆë¡œê·¸";
          default: return "ê²Œì‹œë¬¼";
        }
      }

      // ğŸ”¥ ê´€ë¦¬ì ì „ìš© ìˆ˜ì • ë²„íŠ¼
      const role = localStorage.getItem("role");
      const token = localStorage.getItem("token");
      if (role === "admin" && token) {
        adminBox.style.display = "block";
        editBtn.addEventListener("click", () => {
          location.href = `/kr/admin/edit_post.html?id=${postId}`;
        });
      }

      // ğŸ”— ê³µìœ  ë²„íŠ¼
      const shareLinkBtn = document.getElementById("shareLinkBtn");
      const shareMailBtn = document.getElementById("shareMailBtn");

      shareLinkBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(window.location.href);
          alert("ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (e) {
          alert("ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ì†Œì°½ì—ì„œ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.");
        }
      });

      shareMailBtn.addEventListener("click", () => {
        const subject = encodeURIComponent("[í™”ì¸ë””íœìŠ¤] ë‰´ìŠ¤ ê³µìœ ");
        const body = encodeURIComponent(`${document.title}\n\n${window.location.href}`);
        location.href = `mailto:?subject=${subject}&body=${body}`;
      });
    });
  </script>

</body>
</html>
