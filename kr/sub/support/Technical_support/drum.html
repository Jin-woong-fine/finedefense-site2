<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Drum Selection Tool</title>

<style>
:root {
  --accent:#007aff;
  --border:#e5e5ea;
  --bg:#ffffff;
  --bg-subtle:#f5f5f7;
  --text:#1c1c1e;
  --muted:#6e6e73;
}
* { box-sizing:border-box; }
body {
  font-family:-apple-system,"Apple SD Gothic Neo",system-ui;
  background:var(--bg);
  color:var(--text);
  font-size:14px;
}
h1 { font-size:22px; margin-bottom:20px; }
h2 { font-size:17px; margin-bottom:12px; }
section { margin-bottom:40px; }

.calculator {
  background:var(--bg-subtle);
  border:1px solid var(--border);
  border-radius:14px;
  padding:28px;
}
.calc-row {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:24px;
}
label {
  font-size:13px;
  color:var(--muted);
}
input, select, button {
  margin-top:6px;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}
input:focus, select:focus {
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(0,122,255,.15);
}
button {
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button:hover { background:#0063d1; }

.result {
  margin-top:20px;
  padding:18px;
  border-radius:12px;
  background:#f9f9fb;
  line-height:1.7;
}
.note {
  font-size:12px;
  color:var(--muted);
  margin-top:10px;
}
</style>
</head>

<body>

<h1>Drum Selection Tool</h1>

<section>
<h2>1. Input</h2>

<div class="calculator">
  <div class="calc-row">

    <label>
      Cable Outer Diameter (mm)
      <input type="number" id="cableOD" placeholder="e.g. 25">
    </label>

    <label>
      Required Length (m)
      <input type="number" id="reqLength" placeholder="e.g. 1500">
    </label>

    <label>
      Packing Ratio (%)
      <input type="number" id="packing" value="85">
    </label>

    <label>
      Drum Model
      <select id="drumSelect"></select>
    </label>

    <button id="calcBtn">Calculate</button>

  </div>
</div>

<div class="note">
‚Ä¢ Calculation logic is based on actual winding behavior.  
‚Ä¢ Hub clearance is calculated automatically.
</div>
</section>

<section>
<h2>2. Result</h2>
<div id="output" class="result">Enter values and click Calculate.</div>
</section>

<script>
let drums = [];

/* ===== Load drum.json ===== */
fetch('./drum.json')
  .then(res => res.json())
  .then(json => {
    drums = json;
    populateDrums();
  });

function populateDrums() {
  const select = document.getElementById('drumSelect');
  select.innerHTML = '';
  drums.forEach((d, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = d.reel_no;
    select.appendChild(opt);
  });
}

/* ===== Main Calculation ===== */
document.getElementById('calcBtn').addEventListener('click', () => {

  const cableOD = +cableOD.value;
  const reqLen = +reqLength.value;
  const packing = +packing.value / 100;
  const idx = drumSelect.value;

  if (!cableOD || !reqLen || idx === '') {
    alert('Î™®Îì† Í∞íÏùÑ ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî.');
    return;
  }

  const drum = drums[idx];
  const coreOD = drum.d;   // ÎèôÍ≤Ω
  const width = drum.w2;   // ÎÇ¥Ìè≠

  const lines = Math.floor(width / cableOD * packing);
  if (lines <= 0) {
    output.innerHTML = 'ÏÑ†ÌÉùÌïú ÎìúÎüºÏóê ÏºÄÏù¥Î∏îÏùÑ Í∂åÏ∑®Ìï† Ïàò ÏóÜÏäµÎãàÎã§.';
    return;
  }

  let sum = 0;
  let layers = 0;

  for (let i = 1; i <= 40; i++) {

    let layerLen = Math.floor(
      Math.PI * (coreOD + (2*i - 1) * cableOD) * lines / 1000
    );

    // VBA Î≥¥Ï†ï Î°úÏßÅ
    if (cableOD > 40 && cableOD <= 60) {
      layerLen -= 1;
    } else if (cableOD > 60) {
      layerLen -= (cableOD % 1 > 0.5 ? 1 : 2);
    }

    sum += layerLen;

    if (sum >= reqLen) {
      layers = i;
      break;
    }
  }

  const cableHeight = layers * cableOD;
  const finalOD = coreOD + 2 * cableHeight;

  // üî• Í∂åÍ≥µ ÏûêÎèô Í≥ÑÏÇ∞
  const hub = (finalOD - (coreOD + 2 * cableHeight)) / 2;

  output.innerHTML = `
    <b>Selected Drum</b>: ${drum.reel_no}<br>
    Required Layers: <b>${layers}</b><br>
    Total Wound Length: <b>${sum.toLocaleString()} m</b><br>
    Cable Layer Height: <b>${cableHeight.toFixed(1)} mm</b><br>
    Final Drum OD: <b>${finalOD.toFixed(1)} mm</b><br>
    Hub Clearance: <b>${hub.toFixed(1)} mm</b>
  `;
});
</script>

</body>
</html>
