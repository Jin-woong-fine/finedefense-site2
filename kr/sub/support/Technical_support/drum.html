<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Drum Selection Tool</title>

<style>
:root {
  --accent:#007aff;
  --border:#e5e5ea;
  --bg:#ffffff;
  --bg-subtle:#f5f5f7;
  --text:#1c1c1e;
  --muted:#6e6e73;
}
* { box-sizing:border-box; }
body {
  font-family:-apple-system,"Apple SD Gothic Neo",system-ui;
  background:var(--bg);
  color:var(--text);
  font-size:14px;
}
h1 { font-size:22px; margin-bottom:20px; }
h2 { font-size:17px; margin-bottom:12px; }
section { margin-bottom:40px; }

.calculator {
  background:var(--bg-subtle);
  border:1px solid var(--border);
  border-radius:14px;
  padding:28px;
}
.calc-row {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:24px;
}
label {
  font-size:13px;
  color:var(--muted);
}
input, select, button {
  margin-top:6px;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:14px;
}
input:focus, select:focus {
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(0,122,255,.15);
}
button {
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button:hover { background:#0063d1; }

.result {
  margin-top:20px;
  padding:18px;
  border-radius:12px;
  background:#f9f9fb;
  line-height:1.7;
}
.note {
  font-size:12px;
  color:var(--muted);
  margin-top:10px;
}

.result-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
}

.result-item {
  background:#fff;
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px 16px;
}

.result-label {
  font-size:12px;
  color:var(--muted);
  margin-bottom:4px;
}

.result-value {
  font-size:16px;
  font-weight:600;
}

.badge {
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:600;
}

.badge.ok {
  background:rgba(0,122,255,0.12);
  color:var(--accent);
}

.badge.warn {
  background:rgba(255,159,10,0.15);
  color:#c06a00;
}

.badge.bad {
  background:rgba(255,59,48,0.15);
  color:#c92a2a;
}




</style>
</head>

<body>

<h1>Drum Selection Tool</h1>

<section>
<h2>1. Input</h2>

<div class="calculator">
  <div class="calc-row">

    <label>
      Cable Outer Diameter (mm)
      <input type="number" id="cableOD" placeholder="e.g. 25">
    </label>

    <label>
      Required Length (m)
      <input type="number" id="reqLength" placeholder="e.g. 1500">
    </label>

    <label>
      Packing Ratio (%)
      <input type="number" id="packing" value="85">
    </label>

    <label>
      Drum Model
      <select id="drumSelect"></select>
    </label>

    <button id="calcBtn">Calculate</button>

  </div>
</div>

<div class="note">
• Calculation logic is based on actual winding behavior.  
• This tool is based on Fine Defense standard drum specifications.  
• Results are for reference only; final selection is user's responsibility.
</div>
</section>

<section>
<h2>2. Result</h2>
<div id="output" class="result">Enter values and click Calculate.</div>
</section>

<script>
let drums = [];

/* ===== Load drum.json ===== */
fetch('./drum.json')
  .then(res => res.json())
  .then(json => {
    drums = json;
    populateDrums();
  });

function populateDrums() {
  const select = document.getElementById('drumSelect');
  select.innerHTML = '';
  drums.forEach((d, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = d.reel_no;
    select.appendChild(opt);
  });
}

/* ===== Main Calculation ===== */
document.getElementById('calcBtn').addEventListener('click', () => {

  const cableOD   = Number(document.getElementById('cableOD').value);
  const reqLen    = Number(document.getElementById('reqLength').value);
  const packing   = Number(document.getElementById('packing').value) / 100;
  const idx       = document.getElementById('drumSelect').value;

  if (!cableOD || !reqLen || idx === '') {
    alert('모든 값을 입력해 주세요.');
    return;
  }

  const drum = drums[idx];
  const coreOD = drum.d;   // 동경
  const width  = drum.w2;  // 내폭

  const lines = Math.floor(width / cableOD * packing);
  if (lines <= 0) {
    output.innerHTML = '선택한 드럼에 케이블을 권취할 수 없습니다.';
    return;
  }

  let sum = 0;
  let layers = 0;

  for (let i = 1; i <= 40; i++) {

    let layerLen = Math.floor(
      Math.PI * (coreOD + (2*i - 1) * cableOD) * lines / 1000
    );

    // VBA 보정 로직
    if (cableOD > 40 && cableOD <= 60) {
      layerLen -= 1;
    } else if (cableOD > 60) {
      layerLen -= (cableOD % 1 > 0.5 ? 1 : 2);
    }

    sum += layerLen;

    if (sum >= reqLen) {
      layers = i;
      break;
    }
  }

  const cableHeight = layers * cableOD;
  const finalOD = coreOD + 2 * cableHeight;
    const hub = (drum.D - finalOD) / 2;

    /* ===== 판단 ===== */
    let remark = '';
    let badgeClass = '';

    if (hub > 20) {
    remark = '여유 있음';
    badgeClass = 'ok';
    } else if (hub >= 0) {
    remark = '타이트';
    badgeClass = 'warn';
    } else {
    remark = '권취 불가';
    badgeClass = 'bad';
    }

    /* ===== 결과 출력 ===== */
    output.innerHTML = `
    <div style="margin-bottom:14px;">
        <b>Selected Drum</b>: ${drum.reel_no}
        &nbsp;&nbsp;
        <span class="badge ${badgeClass}">${remark}</span>
    </div>

    <div class="result-grid">
        <div class="result-item">
        <div class="result-label">Required Layers</div>
        <div class="result-value">${layers}</div>
        </div>

        <div class="result-item">
        <div class="result-label">Total Wound Length</div>
        <div class="result-value">${sum.toLocaleString()} m</div>
        </div>

        <div class="result-item">
        <div class="result-label">Cable Layer Height</div>
        <div class="result-value">${cableHeight.toFixed(1)} mm</div>
        </div>

        <div class="result-item">
        <div class="result-label">Calculated Wound OD</div>
        <div class="result-value">${finalOD.toFixed(1)} mm</div>
        </div>

        <div class="result-item">
        <div class="result-label">Drum Max OD</div>
        <div class="result-value">${drum.D} mm</div>
        </div>

        <div class="result-item">
        <div class="result-label">Actual Hub Clearance</div>
        <div class="result-value">${hub.toFixed(1)} mm</div>
        </div>
    </div>

    <div class="note" style="margin-top:14px;">
        ※ 본 계산은 화인디펜스(Fine Defense) 드럼 기준이며, 권공 0 조건으로 산출되었습니다.
    </div>
    `;

});
</script>

</body>
</html>
