<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì œí’ˆ ìƒì„¸ | Fine Defense</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ì‚¬ì´íŠ¸ ê³µí†µ CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <style>
    /* -----------------------------
       ë ˆì´ì•„ì›ƒ
    ------------------------------ */
    .product-detail {
      max-width: 1200px;
      margin: 60px auto 80px;
      padding: 40px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }
    .product-title {
      font-size: 2rem;
      color: #0f2679;
      margin-bottom: 10px;
    }
    .product-category {
      color:#666;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }
    .product-content {
      display:flex;
      flex-wrap:wrap;
      gap:40px;
      align-items:flex-start;
    }
    .product-gallery {
      flex:1 1 45%;
      text-align:center;
    }
    .product-desc {
      flex:1 1 45%;
      font-size:1rem;
      line-height:1.7;
      color:#333;
      min-width: 0;
    }

    /* -----------------------------
       ë©”ì¸ ì´ë¯¸ì§€ + ì¸ë„¤ì¼
    ------------------------------ */
    .main-image img {
      width:100%;
      max-width:420px;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.08);
      object-fit:cover;
      cursor: zoom-in;
      transition: transform 0.2s ease;
    }
    .main-image img:hover {
      transform: scale(1.01);
    }

    .thumb-list {
      margin-top:15px;
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:8px;
    }
    .thumb-list img {
      width:80px;
      height:80px;
      object-fit:cover;
      border-radius:8px;
      opacity:0.7;
      border:2px solid transparent;
      cursor:pointer;
      transition:all 0.2s;
    }
    .thumb-list img.active,
    .thumb-list img:hover {
      opacity:1;
      border-color:#0f2679;
      transform:scale(1.03);
    }

    /* -----------------------------
       Toast ì—ë””í„°ì—ì„œ ë§Œë“  ë‚´ìš©ìš© ìŠ¤íƒ€ì¼
    ------------------------------ */
    .product-desc p {
      margin: 0 0 0.7em;
    }
    .product-desc ul,
    .product-desc ol {
      padding-left: 1.4em;
      margin: 0 0 0.7em;
    }
    .product-desc strong {
      font-weight: 600;
    }

    /* í‘œ ë¼ì¸ ì‚´ë¦¬ê¸° */
    .product-desc table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      table-layout: auto;
    }
    .product-desc th,
    .product-desc td {
      border: 1px solid #d0d4e4;
      padding: 8px 10px;
      font-size: 0.95rem;
      vertical-align: middle;
    }
    .product-desc th {
      background: #f7f8fc;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
    }

    .product-desc img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 10px 0;
    }

    /* -----------------------------
       í™•ëŒ€ ë³´ê¸°(ë¼ì´íŠ¸ë°•ìŠ¤) - ë©”ì¸ ì´ë¯¸ì§€ ì „ìš©
    ------------------------------ */
    .image-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;         /* JSë¡œ ì œì–´ */
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .image-overlay.show {
      display: flex;
    }
    .overlay-inner {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .overlay-image {
      max-width: 100%;
      max-height: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .overlay-close {
      position: absolute;
      top: -40px;
      right: 0;
      font-size: 28px;
      border: none;
      background: transparent;
      color: #fff;
      cursor: pointer;
    }
    .overlay-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(0,0,0,0.4);
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .overlay-arrow:hover {
      background: rgba(0,0,0,0.6);
    }
    .overlay-prev {
      left: -60px;
    }
    .overlay-next {
      right: -60px;
    }

    @media (max-width: 768px) {
      .product-content {
        flex-direction:column;
      }
      .overlay-prev {
        left: 10px;
      }
      .overlay-next {
        right: 10px;
      }
      .overlay-close {
        top: 10px;
        right: 10px;
      }
    }
  </style>
</head>

<body>

  <!-- ê´€ë¦¬ì ì„¸ì…˜ë°” (ì •í™•í•œ ID ë¶€ì—¬) -->
  <div id="adminBarContainer" data-include="/kr/components/admin-session-bar.html"></div>

  <!-- ê³µí†µ í—¤ë” -->
  <div id="headerContainer" data-include="/kr/components/header.html"></div>

<section class="sub-banner">
  <img src="/img/sub-banners/subbanner_product.jpg" alt="ì œí’ˆì†Œê°œ ë°°ë„ˆ">
  <div class="banner-text">
    <h1>ì œí’ˆì†Œê°œ</h1>
    <p>í•´ì–‘ ë°©ì‚° í˜„ì¥ì„ ì—°ê²°í•˜ëŠ” ì¼€ì´ë¸” ì†”ë£¨ì…˜</p>
  </div>
</section>

<div class="breadcrumb">
  <a href="/kr/index.html">í™ˆ</a> &gt;
  <span class="crumb crumb-level1">ì œí’ˆì†Œê°œ</span> &gt;
  <span id="crumbProduct" class="crumb crumb-level2">ì œí’ˆ ìƒì„¸</span>
  <div id="side-tabs" class="side-tabs"></div>
</div>

<section class="product-detail">
  <h1 id="productTitle" class="product-title">ì œí’ˆëª…</h1>
  <div id="productCategory" class="product-category"></div>

  <div class="product-content">
    <div class="product-gallery">
      <div class="main-image">
        <img id="mainImage" src="/img/products/Image-placeholder.png" alt="ì œí’ˆ ì´ë¯¸ì§€">
      </div>
      <div id="thumbList" class="thumb-list"></div>
    </div>

    <!-- description_htmlì´ ì—¬ê¸° ë“¤ì–´ê° -->
    <div id="productDesc" class="product-desc"></div>
  </div>
</section>

    <!-- ê³µí†µ í‘¸í„° -->
    <div data-include="/kr/components/footer.html"></div>

<script>
/* ==========================================================
   ğŸ“Œ ì „ì—­ ìƒíƒœ
========================================================== */
let galleryImages = [];   // [url, url, ...]  (ëŒ€í‘œ + ìƒì„¸ ì´ë¯¸ì§€)
let currentIndex = 0;

/* ==========================================================
   ğŸ“Œ ì´ˆê¸° ë¡œë”©
========================================================== */
document.addEventListener("DOMContentLoaded", () => {
  loadProductDetail();
  setupOverlay();   // í™•ëŒ€ ë·° DOM ë¯¸ë¦¬ êµ¬ì„±
});

/* ==========================================================
   ğŸ“Œ ì œí’ˆ ìƒì„¸ ë°ì´í„° ë¡œë”©
========================================================== */
async function loadProductDetail() {
  const params = new URLSearchParams(window.location.search);
  const productId = params.get("id");

  if (!productId) return;

  try {
    const res = await fetch(`/api/products/${productId}`);
    if (!res.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");

    const data = await res.json();   // { product, images }
    renderProduct(data);
  } catch (err) {
    console.error("loadProductDetail Error:", err);
  }
}

/* ==========================================================
   ğŸ“Œ ì¹´í…Œê³ ë¦¬ í‘œì‹œìš© ë¼ë²¨
========================================================== */
function getCategoryLabel(code) {
  return {
    towed: "ìˆ˜ì¤‘ì´ë™í˜• ì¼€ì´ë¸”",
    fixed: "ìˆ˜ì¤‘ê³ ì •í˜• ì¼€ì´ë¸”",
    connector: "ìˆ˜ì¤‘ ì»¤ë„¥í„°",
    custom: "ì»¤ìŠ¤í…€ ì¼€ì´ë¸”",
  }[code] || "ê¸°íƒ€";
}

/* ==========================================================
   ğŸ“Œ í˜ì´ì§€ ë Œë”ë§
========================================================== */
function renderProduct({ product, images }) {
  const titleEl      = document.getElementById("productTitle");
  const categoryEl   = document.getElementById("productCategory");
  const descEl       = document.getElementById("productDesc");
  const mainImageEl  = document.getElementById("mainImage");
  const thumbListEl  = document.getElementById("thumbList");
  const crumbProduct = document.getElementById("crumbProduct");

  const categoryLabel = getCategoryLabel(product.category || "");

  titleEl.textContent = product.title;
  categoryEl.textContent = `ì¹´í…Œê³ ë¦¬: ${categoryLabel}`;
  // breadcrumb 2ë‹¨ê³„ëŠ” ì¹´í…Œê³ ë¦¬ë¡œ ê³ ì •
  crumbProduct.textContent = categoryLabel;

  // ëŒ€í‘œ ì´ë¯¸ì§€
  const mainImg = product.thumbnail && product.thumbnail.trim()
    ? product.thumbnail
    : "/img/products/Image-placeholder.png";

  mainImageEl.src = mainImg;

  // ìƒì„¸ ì´ë¯¸ì§€ì—ì„œ ëŒ€í‘œì™€ ì¤‘ë³µ ì œê±°
  const thumbFile = product.thumbnail
    ? product.thumbnail.split("/").pop()
    : null;

  const detailImgs = (images || []).filter(img => {
    if (!thumbFile) return true;
    const file = (img.url || "").split("/").pop();
    return file !== thumbFile;
  });

  // ì „ì²´ ê°¤ëŸ¬ë¦¬ ë°°ì—´ êµ¬ì„± (ëŒ€í‘œ + ìƒì„¸)
  galleryImages = [mainImg, ...detailImgs.map(img => img.url)];
  currentIndex = 0;   // ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ 0ë²ˆ ì¸ë±ìŠ¤ë¡œ

  /* ì¸ë„¤ì¼ ë Œë”ë§ */
  thumbListEl.innerHTML = "";

  galleryImages.forEach((url, idx) => {
    const t = document.createElement("img");
    t.src = url;

    if (idx === 0) t.classList.add("active");

    // ì¸ë„¤ì¼ í´ë¦­ â†’ ë©”ì¸ ì´ë¯¸ì§€ë§Œ ë³€ê²½ (í™•ëŒ€ëŠ” X)
    t.addEventListener("click", () => {
      document.querySelectorAll(".thumb-list img").forEach(el =>
        el.classList.remove("active")
      );
      t.classList.add("active");
      currentIndex = idx;
      mainImageEl.src = url;
    });

    thumbListEl.appendChild(t);
  });

  /* ë©”ì¸ ì´ë¯¸ì§€ í´ë¦­ â†’ ë¼ì´íŠ¸ë°•ìŠ¤ ì˜¤í”ˆ */
  mainImageEl.addEventListener("click", () => {
    openOverlay(currentIndex);
  });

  /* description_html ì¶œë ¥ */
  descEl.innerHTML = product.description_html || "<p>ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
}

/* ==========================================================
   ğŸ“Œ ë¼ì´íŠ¸ë°•ìŠ¤(í™•ëŒ€ ë·°) êµ¬ì„±
   - ë©”ì¸ ì´ë¯¸ì§€ í•œ ë²ˆ í´ë¦­ â†’ í™•ëŒ€
   - í™•ëŒ€ ìƒíƒœì—ì„œ ì¢Œìš° í™”ì‚´í‘œë¡œ ìŠ¬ë¼ì´ë“œ
========================================================== */
let overlayEl, overlayImgEl, overlayPrevBtn, overlayNextBtn, overlayCloseBtn;

function setupOverlay() {
  overlayEl = document.createElement("div");
  overlayEl.className = "image-overlay";

  overlayEl.innerHTML = `
    <div class="overlay-inner">
      <button class="overlay-close" type="button">&times;</button>
      <button class="overlay-arrow overlay-prev" type="button">&#10094;</button>
      <img class="overlay-image" src="" alt="í™•ëŒ€ ì´ë¯¸ì§€">
      <button class="overlay-arrow overlay-next" type="button">&#10095;</button>
    </div>
  `;

  document.body.appendChild(overlayEl);

  overlayImgEl   = overlayEl.querySelector(".overlay-image");
  overlayPrevBtn = overlayEl.querySelector(".overlay-prev");
  overlayNextBtn = overlayEl.querySelector(".overlay-next");
  overlayCloseBtn= overlayEl.querySelector(".overlay-close");

  // ë‹«ê¸°
  overlayCloseBtn.addEventListener("click", closeOverlay);

  // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
  overlayEl.addEventListener("click", (e) => {
    if (e.target === overlayEl) {
      closeOverlay();
    }
  });

  // ì¢Œìš° í™”ì‚´í‘œ
  overlayPrevBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    showPrevImage();
  });
  overlayNextBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    showNextImage();
  });

  // ESC / â† / â†’ í‚¤
  document.addEventListener("keydown", (e) => {
    if (!overlayEl.classList.contains("show")) return;

    if (e.key === "Escape") {
      closeOverlay();
    } else if (e.key === "ArrowLeft") {
      showPrevImage();
    } else if (e.key === "ArrowRight") {
      showNextImage();
    }
  });
}

function openOverlay(index) {
  if (!galleryImages.length) return;

  currentIndex = index ?? 0;
  overlayImgEl.src = galleryImages[currentIndex];
  overlayEl.classList.add("show");
}

function closeOverlay() {
  overlayEl.classList.remove("show");
}

function showPrevImage() {
  if (!galleryImages.length) return;
  currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length;
  overlayImgEl.src = galleryImages[currentIndex];
}

function showNextImage() {
  if (!galleryImages.length) return;
  currentIndex = (currentIndex + 1) % galleryImages.length;
  overlayImgEl.src = galleryImages[currentIndex];
}
</script>

    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/js/include.js"></script>
    <script src="/js/session_timer.js"></script>
    <script src="/js/language.js"></script>
    <script src="/js/nav.js"></script>



</body>
</html>
