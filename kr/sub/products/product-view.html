<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì œí’ˆ ìƒì„¸ | Fine Defense</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ê³µí†µ CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/sub-banner.css">

  <!-- Toast UI Viewer CSS -->
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css">

  <style>
    /* --------------------------
        ê¸°ë³¸ ìƒì„¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼
    ---------------------------*/
    .product-detail {
      max-width: 1200px;
      margin: 60px auto 80px;
      padding: 40px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }
    .product-title { font-size: 2rem; color: #0f2679; margin-bottom: 10px; }
    .product-category { color:#666; margin-bottom: 30px; }
    .product-content { display:flex; flex-wrap:wrap; gap:40px; align-items:flex-start; }
    .product-gallery { flex:1 1 45%; text-align:center; }

    .main-image img {
      width:100%; max-width:420px;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.08);
      cursor:pointer;
    }

    .thumb-list {
      margin-top:15px;
      display:flex; flex-wrap:wrap;
      justify-content:center;
      gap:8px;
    }
    .thumb-list img {
      width:80px; height:80px;
      object-fit:cover;
      border-radius:8px;
      opacity:0.7;
      border:2px solid transparent;
      cursor:pointer;
      transition:all 0.2s;
    }
    .thumb-list img.active,
    .thumb-list img:hover {
      opacity:1;
      border-color:#0f2679;
      transform:scale(1.03);
    }

    .product-desc { flex:1 1 45%; }

    @media (max-width: 768px) {
      .product-content { flex-direction:column; }
    }

    /* --------------------------
        Toast UI í‘œ ìŠ¤íƒ€ì¼ FIX
    ---------------------------*/
    .toastui-editor-contents table {
      border-collapse: collapse !important;
      width: 100%;
      margin: 12px 0;
    }
    .toastui-editor-contents th,
    .toastui-editor-contents td {
      border: 1px solid #ccc !important;
      padding: 8px 10px;
    }
    .toastui-editor-contents th {
      background:#f5f7fa;
      font-weight:600;
    }

    /* --------------------------
       ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬
    ---------------------------*/
    .img-modal {
      display:none;
      position:fixed;
      z-index:9999;
      left:0; top:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.85);
      justify-content:center;
      align-items:center;
      overflow:hidden;
    }
    .img-modal img {
      max-width:90%;
      max-height:90%;
      border-radius:12px;
      box-shadow:0 0 25px rgba(0,0,0,0.5);
      transition: transform 0.25s ease;
    }
  </style>
</head>

<body>

<div id="header"></div>

<section class="sub-banner">
  <img src="/img/sub-banners/cable.jpg" alt="ì œí’ˆì†Œê°œ ë°°ë„ˆ">
  <div class="banner-text">
    <h1>ì œí’ˆì†Œê°œ</h1>
    <p>í•´ì–‘ ë°©ì‚° í˜„ì¥ì„ ì—°ê²°í•˜ëŠ” ì¼€ì´ë¸” ì†”ë£¨ì…˜</p>
  </div>
</section>

<div class="breadcrumb">
  <a href="/kr/index.html">í™ˆ</a> &gt;
  <span class="crumb crumb-level1">ì œí’ˆì†Œê°œ</span> &gt;
  <span id="crumbProduct" class="crumb crumb-level2">ì œí’ˆ ìƒì„¸</span>
  <div id="side-tabs" class="side-tabs"></div>
</div>

<section class="product-detail">
  <h1 id="productTitle" class="product-title">ì œí’ˆëª…</h1>
  <div id="productCategory" class="product-category"></div>

  <div class="product-content">
    <div class="product-gallery">
      <div class="main-image">
        <img id="mainImage" src="/img/products/Image-placeholder.png" alt="ì œí’ˆ ì´ë¯¸ì§€">
      </div>
      <div id="thumbList" class="thumb-list"></div>
    </div>

    <div id="productDesc" class="product-desc"></div>
  </div>
</section>

<div id="footer"></div>

<!-- ëª¨ë‹¬(í™•ëŒ€ ì´ë¯¸ì§€) -->
<div id="imgModal" class="img-modal">
  <img id="modalImg">
</div>

<script src="/js/nav.js"></script>
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.js"></script>

<script>
/* =====================================================
   ğŸ“Œ ë°ì´í„° ë¡œë”©
===================================================== */
document.addEventListener("DOMContentLoaded", loadProductDetail);

let galleryImages = [];      // ëª¨ë“  ì´ë¯¸ì§€ ëª©ë¡
let currentIndex = 0;        // í˜„ì¬ í™•ëŒ€ì¤‘ì¸ ì´ë¯¸ì§€ index

async function loadProductDetail() {
  const id = new URLSearchParams(location.search).get("id");
  if (!id) return;

  const res = await fetch(`/api/products/${id}`);
  const data = await res.json();
  renderProduct(data);
}

/* =====================================================
   ğŸ“Œ ìƒì„¸ í˜ì´ì§€ ë Œë”ë§
===================================================== */
function renderProduct({ product, images }) {
  document.getElementById("productTitle").textContent = product.title;
  const categoryLabel = getCategoryLabel(product.category);
  document.getElementById("productCategory").textContent = `ì¹´í…Œê³ ë¦¬: ${categoryLabel}`;
  document.getElementById("crumbProduct").textContent = categoryLabel;

  /* ë©”ì¸ ì´ë¯¸ì§€ ì„¤ì • */
  const mainImg = product.thumbnail || "/img/products/Image-placeholder.png";
  const mainImageEl = document.getElementById("mainImage");
  mainImageEl.src = mainImg;

  /* ì „ì²´ ì´ë¯¸ì§€ ëª©ë¡ êµ¬ì„± */
  galleryImages = [
    mainImg,
    ...images
      .map(i => i.url)
      .filter(url => url !== product.thumbnail)
  ];

  /* ë©”ì¸ ì´ë¯¸ì§€ í´ë¦­ â†’ í™•ëŒ€ */
  mainImageEl.addEventListener("click", () => openModal(0));

  /* ì¸ë„¤ì¼ ë Œë”ë§ */
  const thumbList = document.getElementById("thumbList");
  thumbList.innerHTML = "";

  galleryImages.forEach((url, idx) => {
    const t = document.createElement("img");
    t.src = url;
    if (idx === 0) t.classList.add("active");

    t.addEventListener("click", () => {
      currentIndex = idx;
      document.querySelectorAll(".thumb-list img").forEach(a => a.classList.remove("active"));
      t.classList.add("active");
      mainImageEl.src = url;
    });

    t.addEventListener("click", () => openModal(idx));

    thumbList.appendChild(t);
  });

  /* Toast UI Viewer */
  new toastui.Editor.factory({
    el: document.getElementById("productDesc"),
    viewer: true,
    initialValue: product.description_html || "<p>ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</p>"
  });
}

/* =====================================================
   ğŸ“Œ ëª¨ë‹¬(í™•ëŒ€ ì´ë¯¸ì§€)
===================================================== */
const modal = document.getElementById("imgModal");
const modalImg = document.getElementById("modalImg");

function openModal(idx) {
  currentIndex = idx;
  modalImg.src = galleryImages[currentIndex];
  modal.style.display = "flex";
}

modal.addEventListener("click", () => closeModal());

function closeModal() {
  modal.style.display = "none";
}

/* =====================================================
   ğŸ“Œ ì¢Œ/ìš° ì´ë™ (í‚¤ë³´ë“œ)
===================================================== */
document.addEventListener("keydown", (e) => {
  if (modal.style.display !== "flex") return;

  if (e.key === "ArrowRight") nextImg();
  if (e.key === "ArrowLeft") prevImg();
  if (e.key === "Escape") closeModal();
});

/* =====================================================
   ğŸ“Œ ì¢Œ/ìš° ì´ë™ (í„°ì¹˜ ìŠ¤ì™€ì´í”„)
===================================================== */
let startX = 0;

modal.addEventListener("touchstart", e => {
  startX = e.changedTouches[0].clientX;
});

modal.addEventListener("touchend", e => {
  const endX = e.changedTouches[0].clientX;

  if (endX - startX > 60) prevImg();     // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ â†’ ì´ì „
  if (startX - endX > 60) nextImg();     // ì™¼ìª½ ìŠ¤ì™€ì´í”„ â†’ ë‹¤ìŒ
});

/* =====================================================
   ğŸ“Œ ì´ë¯¸ì§€ ì´ë™ í•¨ìˆ˜
===================================================== */
function nextImg() {
  currentIndex = (currentIndex + 1) % galleryImages.length;
  modalImg.src = galleryImages[currentIndex];
}

function prevImg() {
  currentIndex =
    (currentIndex - 1 + galleryImages.length) % galleryImages.length;
  modalImg.src = galleryImages[currentIndex];
}

/* =====================================================
   ğŸ“Œ ì¹´í…Œê³ ë¦¬ ë¼ë²¨
===================================================== */
function getCategoryLabel(code) {
  return {
    towed: "ìˆ˜ì¤‘ì´ë™í˜• ì¼€ì´ë¸”",
    fixed: "ìˆ˜ì¤‘ê³ ì •í˜• ì¼€ì´ë¸”",
    connector: "ìˆ˜ì¤‘ ì»¤ë„¥í„°",
    custom: "ì»¤ìŠ¤í…€ ì¼€ì´ë¸”",
  }[code] || "ê¸°íƒ€";
}
</script>

</body>
</html>
